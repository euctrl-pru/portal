---
layout: default
title: ANSPs Financial Dashboard
---
  <style>
    .MyTableCell {font-size: 12px;
       text-align: right;
       border: solid 1px #c8c8c8;
    }
    .Mybluedata {background-color: rgb(221, 235, 247)}
    .Mygreydata {background-color: rgb(230, 230, 230)}
    .MyTableHeader {
      text-align: right;
      font-size: 12px;
      border: solid 5px black;
      background-color: #e4e8ed;
    }
    .ScorecardTitle {
     margin: 0px; 
     padding-top: 2px;
     text-align: center;
     font-weight: bold;
     font-size: 14px; 
     color:#161b21;
     border-bottom: solid 1px #002060
    }
    h4 {
      background-color: #002060;
      border-radius: 5px;
      color: white; 
      padding-left: 10px;
      padding-bottom: 3px;
      margin-top: 15px;
      font-size: 20px;
    }
    h6 {
      border-bottom: solid 3px #5b9bd5;
      font-size: 14px; font-weight: bold;
      margin-top: 10px;
    }
    /* .Mycolumn {margin-bottom: 5px;} */
    @media screen and (min-width:1000px) {
    .flex-container{
      display: flex;
    }
    .Mycolumn {width: 50%; margin-right:5px}
    .Mycolumn2 {width: 50%; margin-left:5px; margin-right:5px}
    /* .Scorecard {
    margin: 0px; 
    font-size: 35px; 
    font-weight: bolder; 
    color:#161b21; 
    text-align: center;
    } */
    .FirstCashScorecard {padding-top: 40px;}
    .googlefilter{
      font-size: 22px; font-weight: bold; 
      flex-flow: row wrap;
    }
    .googlefilter2{
      font-size: 22px; font-weight: normal; 
      flex-flow: row wrap;
    }
    }

    @media screen and (max-width:1000px) {
    .Mycolumn {width: 100%;margin-right: 0px;};
    .Mycolumn2 {width: 100%; margin-left: 0px; margin-right:0px}
    .FirstCashScorecard {padding-top: 20px;}
    .googlefilter{
      font-size: 18px; font-weight: bold; 
      flex-flow: row wrap;
    }
    .googlefilter2{
      font-size: 18px; font-weight: normal; 
      flex-flow: row wrap;
    }
    }
    @media screen and (max-width: 1000px) {
    .Scorecard {
    margin: 0px; 
    padding: 0px; 
    font-size: 22px; 
    font-weight: bolder; 
    color:#161b21; 
    text-align: center;
    }
    .MyCurrency{
    margin: 0px; 
    padding: 0px; 
    font-size: 16px; 
    font-weight: bolder; 
    color:#161b21; 
    text-align: center; 
    }
    }
    @media screen and (min-width: 1000px) {
    .Scorecard {
    margin: 0px; 
    padding: 0px; 
    font-size: 30px; 
    font-weight: bolder; 
    color:#161b21; 
    text-align: center;
    }
    .MyCurrency{
    margin: 0px; 
    padding: 0px; 
    font-size: 20px; 
    font-weight: bolder; 
    color:#161b21; 
    text-align: center; 
    }
    }
     /* .Myalignleft {text-align: left;}   */
     table {
   margin: 0px;
   font-size: 12px;
   font-weight: bold;
   margin: 0px"
}

  </style>

   <p>This dashboard presents financial information and indicators for European ANSPs, and contains interactive features that allow for comparisons over time. All information presented is publicly available and has been collected from ANSPs’ most recent financial statements.</p>
   <p>You can find more details about the content and purpose of this dashboard as well as the definition of the indicators used in our <a href="./guide/">Reader's Guide.</a></p>

    <div class="flex-container ml-1 mr-1" style=" padding-right: 15px; border-bottom: solid 3px #161b21; 
     padding-top: 10px;">
      <div class="row" style="padding-left: 20px; width: 100%;">
        <div class="googlefilter" style="font-weight: normal; padding-top: 10px; padding-right: 15px;">Select ANSP:</div>
        <div id="EntityPicker_div" ></div>
        <div class="googlefilter2" style=" padding-top: 10px; padding-left: 20px; padding-right: 15px;">Select Year:</div>
        <div id="YearPicker_div" ></div>
      </div>
        <div id="ANSP_logo" style="clear:both; justify-content: flex-end; margin-bottom: 0px;"></div>
    </div>

<!-- Main Title section -->
     <!-- <p id="ANSP_Name" style= "font-size: 24px; font-weight: bold; border-bottom: solid 3px #161b21; 
     padding-top: 10px; margin-right: 5px">ENAV</p> -->
  
    <div class="flex-container" style="margin-right: 5px; margin-top:10px">
      
      <div class="Mycolumn mb-2 " ; style="margin-left:15px;">
        <div class="row" style="padding-left: 10px; ">
          <div class="col-12 pl-0" >
            <p id="ANSP_Full_Name" style="font-size: 16px; font-style: italic;"></p>
            <p style="font-size: 14px; font-weight: bold; margin: 0px;">Organisational & Corporate Arrangements:</p>
            <p id="Ownership" style="font-size: 14px; margin: 0px; font-weight: normal"></p>
          </div>
        </div>
      </div>

      <div class= "Mycolumn2 mb-2"; style=" padding: 0px; padding-left: 15px; padding-right: 0px; width:400px">
       <p style="font-size: 14px; margin-bottom: 0;" >Additional scope of activities</p>
       <p style="font-size: 14px; margin-top: 0; margin-bottom: 5px;">(in addition to the provision of ATC services to GAT)</p>
        <table>
        <tr>
         <td class= "MyTableCell font-weight-bold text-left pl-1 pr-1">OAT Services</td>
         <td class= "MyTableCell font-weight-bold text-left pl-4 pr-4"><i id="OAT_Services" class="fa fa-check text-white" aria-hidden="true"></i></td>
        </tr>
        <tr>
         <td class= "MyTableCell font-weight-bold text-left pl-1 pr-1">Oceanic</td>
         <td  class="MyTableCell font-weight-bold text-left pl-4 pr-4"><i id="Oceanic_Services" class="fa fa-check text-white" aria-hidden="true"></i></td>
        </tr>
        <!-- <tr>
         <td class= "MyTableCell font-weight-bold text-left pl-1 pr-1">MUAC</td>
         <td class= "MyTableCell font-weight-bold text-left pl-4 pr-4"><i id="MUAC" class="fa fa-check text-white" aria-hidden="true"></i></td>
        </tr> -->
        <tr>
         <td class= "MyTableCell font-weight-bold text-left pl-1 pr-1">Delegated ATM</td>
         <td class= "MyTableCell font-weight-bold text-left pl-4 pr-4"><i id="Delegated_ATM" class="fa fa-check text-white" aria-hidden="true"></i></td>
         </tr>
        <tr>
         <td class= "MyTableCell font-weight-bold text-left pl-1 pr-1">Internal MET</td>
         <td class= "MyTableCell font-weight-bold text-left pl-4 pr-4"><i id="Internal_MET" class="fa fa-check text-white" aria-hidden="true"></i></td>
        </tr>
        <tr>
         <td class= "MyTableCell font-weight-bold text-left pl-1 pr-4">Ownership and management of airports</td>
         <td class= "MyTableCell font-weight-bold text-left pl-4 pr-4"><i id="Airports" class="fa fa-check text-white" aria-hidden="true"></i></td>
        </tr>
       </table>
      </div>
      <div class="mb-2 ml-2" style="width:180px" >
        <p  style="margin-bottom: 0px; margin-left: -15px; font-size: 14px; text-align: center;">
         <span id="MyTitleShareRevenue_div">Share of Pan-European System</span><span><a href="#" data-toggle="tooltip" data-placement="right" title="Based on 2017-2019 avg.">*</a></span>
        </p>
        <div id="MyPieShareRevenue_div" style="margin-bottom: 0px;"></div>
        <!-- <p style="margin: 0px; font-size: 14px;"> Share of total revenue</p> -->
        <!-- <p id="Scorecard_RevenueRatio" ; style="margin: 0px; font-size: 35px; font-weight: bolder;">5.5%</p> -->
      </div>
    </div>
    
<!-- Income statement section -->
    <h4 id="income_title" >Income Statement</h4>
    <!-- <i class="fa fa-clone" aria-hidden="true"></i> -->

    <!-- Scorecards -->
    <div class="flex-container" style=" margin-bottom: 5px;">
      <div class="Mycolumn" style="display:flex">
        <div class="col-4" ;
      style="margin: 0px; padding-left: 15px; border: solid 2px #002060; border-radius: 5px;">
          <p id="Title_Revenue" class="ScorecardTitle">Revenue 2019</p>
          <p style="text-align: center;">
            <span id="Scorecard_Revenue" class="Scorecard"></span>
            <span id="Scorecard_Revenue_Curr" class="MyCurrency">€ M</span>
          </p>
          <!-- <p id="Scorecard_Revenue" class="Scorecard">-€ M</p> -->
          <p id="Dif_Revenue" style="margin-top: -15px; margin-bottom: 0px; padding-bottom: 5px; font-size: 14px; text-align: center; color:#161b21">
       -% vs. -</p>
        </div>

        <div class="col-4" ;
        style="margin: 0px; margin-left: 15px; padding-left: 15px; border: solid 2px #002060; border-radius: 5px;">
         <p class="ScorecardTitle">
            <span>OPEX</span><span><a href="#" data-toggle="tooltip" data-placement="right"
                title="Not including depreciation, amortisation and other non-cash items.">*</a></span><span id="Title_OPEX"></span>
         </p>
          <p style="text-align: center;">
           <span id="Scorecard_OPEX" class="Scorecard"></span>
           <span id="Scorecard_OPEX_Curr" class="MyCurrency">€ M</span>
          </p>
          <!-- <p id="Scorecard_OPEX" class="Scorecard">-€ M</p> -->
          <p id="Dif_OPEX" style="margin-top: -15px; margin-bottom: 0px; padding-bottom: 5px; font-size: 14px; text-align: center; color:#161b21">
          -% vs. -</p>
        </div>
      </div>

      <div class="Mycolumn" style="display:flex">
        <div class="col-4" ;
          style="margin: 0px; margin-left: 0px; padding-left: 5px; padding-right: 5px; border: solid 2px #002060; border-radius: 5px;">
          <p id="Title_EBITDAMargin" class="ScorecardTitle">EBITDA Margin 2019</p>
          <p id="Scorecard_EBITDAMargin" class="Scorecard">-%</p>
          <p id="Dif_EBITDAMargin" style="margin: 0px; padding-bottom: 5px; font-size: 14px; text-align: center; color:#161b21">
            p.p. vs. -</p>
        </div>
      
        <div class="col-4" ;
          style="margin: 0px; margin-left: 15px; padding-left: 15px; border: solid 2px #002060; border-radius: 5px;">
          <p id="Title_EBITMargin" class="ScorecardTitle">EBIT Margin 2019</p>
          <p id="Scorecard_EBITMargin" class="Scorecard">-%</p>
          <p id="Dif_EBITMargin" style="margin: 0px; padding-bottom: 5px; font-size: 14px; text-align: center; color:#161b21">
            p.p. vs. -</p>
        </div>
      </div>
    </div>

      <div class="flex-container">
      <div class="Mycolumn" >
        <h6>Revenues & Costs</h6>
          <div class="row" style="margin-left: 0px;">
          <div id="MyChartIncome1Selector_div" class="col-2" ; style="padding: 0px; ">
            <button type="button" class="btn btn-dark btn-sm pb-0 pt-0 font-weight-bold" style="float: left; margin: 0px; margin-top: 8px;width: 98%;"
              id="ButtonRevenue1" onclick="PassMetric1='Revenue'; FButtonMetric1()">Revenue</button>
            <button type="button" class="btn btn-dark btn-sm pb-0 pt-0 font-weight-bold" style="float: left; margin-top: 3px; width: 98%;" id="ButtonOPEX1" onclick="PassMetric1='Opex'; FButtonMetric1()">Opex</button>
            <button type="button" class="btn btn-dark btn-sm pb-0 pt-0 font-weight-bold" style="float: left; margin-top: 3px; width: 98%;" id="ButtonEBITDA1" onclick="PassMetric1='EBITDA'; FButtonMetric1()">EBITDA</button>
            <button type="button" class="btn btn-secondary btn-sm pb-0 pt-0" style="float: left; margin-top: 3px; width: 98%;" id="ButtonDepAmo1" onclick="PassMetric1='Depreciation and amortisation'; FButtonMetric1()">Depr & Amort</button>
            <button type="button" class="btn btn-secondary btn-sm pb-0 pt-0" style="float: left; margin-top: 3px; width: 98%;"
              id="ButtonEBIT1" onclick="PassMetric1='EBIT'; FButtonMetric1()">EBIT</button>
            <!-- <button type="button" class="btn btn-secondary btn-sm pb-0 pt-0" style="float: left; margin-top: 3px; width: 98%;" id="ButtonNetFinIE1" onclick="PassMetric1='Net financial income/expense'; FButtonMetric1()">Net Fin I/E</button> -->
            <button type="button" class="btn btn-secondary btn-sm pb-0 pt-0" style="float: left; margin-top: 3px; width: 98%;"    id="ButtonPTP1" onclick="PassMetric1='Pre-tax profit'; FButtonMetric1()">Pre-Tax Profit</button>
          </div>
          <div class="col-10" ; style="padding: 0px">
            <div id="MyChartIncome1_div" ; style="margin-right: 10px"></div>
          </div>
        </div>
        <h6 id="incomeitems_title">Income Statement Items (€ M)</h6>
        <div id="MyTableIncome_div" class="col-12" ; style="padding: 0px;"></div>
      </div>
      <div class="Mycolumn2" >
        <h6>Profit Margins %</h6>
        <div id="MyChartIncome2_div" ></div>
      </div>
    </div>

<!-- Balance Sheet section -->
    <h4 id="balance_title">Balance Sheet</h4>

    <!-- Scorecards -->
    <div class="flex-container" style=" margin-bottom: 5px;">
    
      <!-- <div class="col-2" style="margin: 0px;"></div> --> 
      <div class="Mycolumn" style="display:flex">
        <div class="col-4"  ;
        style="padding-left: 5px; padding-right: 5px; border: solid 2px #002060; border-radius: 5px;">
          <p id="Title_DebtToEquity" class="ScorecardTitle">Debt to equity ratio 2019</p>
          <p id="Scorecard_DebtToEquity" class="Scorecard">-</p>
          <p id="Dif_DebtToEquity" style="margin: 0px; padding-bottom: 5px; font-size: 14px; text-align: center; color:#161b21">
          - in -</p>
        </div>
      </div>
    
      <div class="Mycolumn" style="display:flex">
        <div class="col-4" ;
        style="margin: 0px; margin-left: 0px; padding-left: 5px; padding-right: 5px; border: solid 2px #002060; border-radius: 5px;">
          <p id="Title_DaysOPEX" class="ScorecardTitle">Cash-on-hand days 2019</p>
          <p id="Scorecard_DaysOPEX" class="Scorecard">-</p>
          <p id="Dif_DaysOPEX" style="margin: 0px; padding-bottom: 5px; font-size: 14px; text-align: center; color:#161b21">
          - in -</p>
        </div>

        <div class="col-4" ;
        style="margin: 0px; margin-left: 15px; padding-left: 15px; border: solid 2px #002060; border-radius: 5px;">
          <p id="Title_CurrentRatio" class="ScorecardTitle">Current ratio 2019</p>
          <p id="Scorecard_CurrentRatio" class="Scorecard">-%</p>
          <p id="Dif_CurrentRatio"
          style="margin: 0px; padding-bottom: 5px; font-size: 14px; text-align: center; color:#161b21">- in -</p>
        </div>
      </div>
    </div>

    <div class="flex-container" >
      <div class="Mycolumn" >
        <div class="row" style="padding-left: 15px; "> 
          <div class= "col-12 pl-0" style="margin-right: 6px;">
          <h6>Assets, Liabilities and Equity</h6>
          <div id="MyChartBalance1_div" style="padding: 0px; padding-top: 20px; background-color: #e4e8ed; text-align: center;">
          </div>
          </div>
        </div>
      </div>
      <div class="Mycolumn2" >
        <div class="row" style="padding-left: 15px;   ">
          <div class="col-12 pl-0" style="padding-right: 15px;">
        <h6>Cash</h6>
        <div id="MyChartBalance2_div" ></div>
      </div>
      </div>
      </div>
    </div>
    
    <div class="flex-container" >
      <div class="Mycolumn" >
        <h6 id="Title_LiabilitiesEquity">Liabilites & Equity</h6>
        <div class="row" style="padding-left: 25px; ">
          <div id="MyScoreCardsBalance_div" class="col-6 FirstCashScorecard" >
            <table style="font-size: 12px; font-weight: bold;">
              <tr style="background-color: #161b21; color: white">
                <td id="equity_subtitle" style="padding-left: 5px; padding-right: 0px;">Shareholders Equity (€ M):</td>
                <td id="Scorecard_Equity" style="padding-left: 50px; padding-right: 5px; text-align: right;">-</td>
              </tr>
              <tr height=10px></tr>
              <tr style="background-color: #00b0bf; color: white">
                <td id="liabilities_subtitle" style="padding-left: 5px; padding-right: 0px;">Total Liabilites (€ M):</td>
                <td id="Scorecard_Liab" style="padding-left: 50px; padding-right: 5px; text-align: right;">-</td>
              </tr>
              <tr height=10px></tr>
              <tr style="background-color: #0073e3; color: white">
                <td id="equliab_subtitle"style="padding-left: 5px; padding-right: 0px;">Liabilities & Equity (€ M):</td>
                <td id="Scorecard_LiabEqui" style="padding-left: 50px; padding-right: 5px; text-align: right;">-</td>
              </tr>
            </table>
          </div>
          <div id="MyPieChartBalance_div" class="col-6" style="margin-top: 0px; padding-top: 0px; font-size: 14px; text-align: center;"></div>
        </div>
        <h6 id="balanceitems_title" style="padding-top: 10px;">Balance Sheet Items (€ M)</h6>
        <div id="MyTableBalance_div" ></div>
      </div>
    
      <div class="Mycolumn2" >
        <h6>Current Assets and Current Liabilities</h6>
        <div id="MyChartBalance3_div"  ></div>
      </div>
    </div>

<!-- Cashflow Statement section -->
    <h4 id="cashflow_title">Cash Flow Statement</h4>

    <!-- Scorecards -->
    <div class="flex-container" style=" margin-bottom: 5px;">
      <div class="Mycolumn" style="display:flex">
        <div class="col-4" ;
         style="margin: 0px; margin-left: 0px; padding-left: 15px; border: solid 2px #002060; border-radius: 5px;">
         <p id="Title_NetCashFlow" class="ScorecardTitle">Net cash flow</p>
          <p style="text-align: center;">
           <span id="Scorecard_NetCashFlow" class="Scorecard"></span>
           <span id="Scorecard_NetCashFlow_Curr" class="MyCurrency">€ M</span>
          </p>
         <!-- <p id="Scorecard_NetCashFlow" class="Scorecard">-</p> -->
         <p id="Dif_NetCashFlow" style="margin-top: -15px; margin-bottom: 0px; padding-bottom: 5px; font-size: 14px; text-align: center; color:#161b21">
          -% vs. -</p>
          
         </div>
    
        <div class="col-4" ;
          style="margin: 0px; margin-left: 15px; padding-left: 5px; padding-right: 5px; border: solid 2px #002060; border-radius: 5px;">
          <p id="Title_NetInvestment" class="ScorecardTitle" ">Investing activities</p>
          <p style="text-align: center;">
           <span id="Scorecard_NetInvestment" class="Scorecard"></span>
           <span id="Scorecard_NetInvestment_Curr" class="MyCurrency">€ M</span>
          </p>
        <!-- <p id="Scorecard_NetInvestment" class="Scorecard">-%</p> -->
          <p id="Dif_NetInvestment" style="margin-top: -15px; margin-bottom: 0px; padding-bottom: 5px; font-size: 14px; text-align: center; color:#161b21">-% vs. -</p>
        </div>
      </div>
    
      <div class="Mycolumn" style="display:flex">
        <div class="col-4" ;
          style="margin: 0px; margin-left: 0px; padding-left: 5px; padding-right: 5px; border: solid 2px #002060; border-radius: 5px;">
          <p id="Title_FreeCashFlow" class="ScorecardTitle">Free cash flow</p>
          <p style="text-align: center;">
            <span id="Scorecard_FreeCashFlow" class="Scorecard"></span>
            <span id="Scorecard_FreeCashFlow_Curr" class="MyCurrency">€ M</span>
          </p>
          <p id="Dif_FreeCashFlow" style="margin-top: -15px; margin-bottom: 0px; padding-bottom: 5px; font-size: 14px; text-align: center; color:#161b21">
            -% vs. -</p>
        </div>
      
        <div class="col-4" ;
          style="margin: 0px; margin-left: 15px; padding-left: 15px; border: solid 2px #002060; border-radius: 5px;">
          <p class="ScorecardTitle">
            <span>CAPEX</span><span><a href="#" data-toggle="tooltip" data-placement="right" title="Component of cash flow from investing activities that represents the funds used to acquire capital non-current assets.">*</a></span><span id="Title_Capex"></span>
          </p>
          <p style="text-align: center;">
            <span id="Scorecard_Capex" class="Scorecard"></span>
            <span id="Scorecard_Capex_Curr" class="MyCurrency">€ M</span>
          </p>
          <p id="Dif_Capex"
            style="margin-top: -15px; margin-bottom: 0px; padding-bottom: 5px; font-size: 14px; text-align: center; color:#161b21">-% vs. -</p>
        </div>
      </div>
    </div>

    <!-- Titles -->
    <div class="flex-container">
      <div class="Mycolumn" >
        <div class="row" style="padding-bottom: 0px; padding-right: 19px ">
          <div class="col-6" >
            <h6 style="margin-left: 0px; padding-left: 0px;">Net Cash Flow</h6>
          </div>
          <div class="col-6" style="padding: 0px; margin-top: 10px;">
            <button type="button" class="btn btn-secondary btn-sm" style="float: right; padding-bottom: 0px; padding-top: 0px; " id="ButtonCashPerc" onclick="PassCashType='% of Revenue'; UpdateMyChartCash1()">As % of Revenue</button>
            <button type="button" class="btn btn-dark btn-sm font-weight-bold" style="float: right; padding-bottom: 0px; padding-top: 0px; margin-right: 4px;" id="ButtonCashAbs" onclick="PassCashType='Absolute'; UpdateMyChartCash1()">Absolute values</button>
          </div>
        </div>
        <div id="MyChartCash1_div" style="padding: 0px; margin-right: -6px;"> </div>        
        
        <h6 id="cashflowitems_title">Net Cash Flow Items (€ M)</h6>
        <div id="MyTableCash_div"></div>
      </div>
    
      <div class="Mycolumn2" >
        <div class="row" style="padding-bottom: 0px; padding-right: 19px ">
         <div class="col-6">
          <h6 style="margin-left: 0px; padding-left: 0px;">Free Cash Flow</h6>
         </div>
         <div class="col-6" style="padding: 0px; margin-top: 10px;">
          <button type="button" class="btn btn-secondary btn-sm" style="float: right; padding-bottom: 0px; padding-top: 0px; "
           id="ButtonCashPerc2" onclick="PassCashType2='% of Revenue'; UpdateMyChartCash2()">As % of Revenue</button>
          <button type="button" class="btn btn-dark btn-sm font-weight-bold"
           style="float: right; padding-bottom: 0px; padding-top: 0px; margin-right: 4px;" id="ButtonCashAbs2"
           onclick="PassCashType2='Absolute'; UpdateMyChartCash2()">Absolute values</button>
         </div>
        </div>
        <div id="MyChartCash2_div" style="padding: 0px; margin-right: -6px;"></div>

        <h6 id="freecashflowitems_title">Free Cash Flow Items (€ M)</h6>
        <div id="MyTableFreeCash_div"></div>
      </div>
    </div>
  </div>

<script
  type="text/javascript"
  src="https://www.gstatic.com/charts/loader.js"
></script>

<script type="text/javascript">
  var Data;
  var EntityPicker;
  var YearPicker;
  var MyViewANSPServices;
  var MyViewShareTotalRevenue;
  var MyTableShareTotalRevenue;

  var MyChartIncome1;
  var MyViewIncome1;
  var EbitdaException

  var MyChartIncome2;
  var MyViewIncome2;

  var MyTableIncome;
  var MyViewTableIncome;
  var TransposedTable;

  var MyChartBalance1;
  var MyViewBalance1;

  var MyChartBalance2;
  var MyViewBalance2;

  var MyTableBalance;
  var MyViewTableBalance;
  var TransposedTableBalance;

  var MyChartBalance3;
  var MyViewBalance3;

  var MyPieChartBalance;
  var MyPieViewBalance;

  var MyChartCash1;
  var MyViewCash1;

  var MyChartCash2;
  var MyViewCash2;

  var MyTableCash;
  var MyViewTableCash;
  var TransposedTableCash;

  var MyTableFreeCash;
  var MyViewTableFreeCash;
  var TransposedTableFreeCash;

  var SelectedEntity = "ENAV";
  var SelectedYear = 2020;
  var MinYear;
  var DataFlag;
  var DecimalsDivisor;

  var NatCurrency;
  var XRate;
  var CurrMultiplierString;
  var CurrMultiplier;
  var MyPattern;
  var SelectedMetricIncome1 = ["Revenue", "Opex", "EBITDA"]
  var MySelectedRow;
  var PassCashType = "Absolute";
  var PassCashType2 = "Absolute";

  google.load("visualization", "1.1", {
    packages: ["corechart", "table", "controls", "bar"]
  });
  google.setOnLoadCallback(Initialisation);

  function Initialisation() {
    var query = new google.visualization.Query(
      "https://docs.google.com/spreadsheets/d/1ZzggKApomo82nPkXmlQhvgv7AY1nE4RhpN83q3hbwzM/edit?usp=sharing&sheet=2020_Data"
    );

    query.send(drawDashboard);
  }
  
  function drawDashboard(response) {
    Data = response.getDataTable();

    //------------------------ANSP Picker--------------------------------------------
    EntityPicker = new google.visualization.ControlWrapper({
      controlType: "CategoryFilter",
      containerId: "EntityPicker_div",
      dataTable: Data,
      state: { selectedValues: [SelectedEntity] },
      options: {
        filterColumnLabel: "ANSP",
        ui: {
          label: "",
          caption: "",
          cssClass: "googlefilter",
          //						labelStacking: 'vertical',
          allowTyping: false,
          allowMultiple: false,
          sortValues: true,
          allowNone: false
        }
      }
    });
    EntityPicker.draw();
    google.visualization.events.addListener(
      EntityPicker,
      "statechange",
      changeEntityPicker
    );

    function changeEntityPicker() {
      SelectedEntity = EntityPicker.getState().selectedValues[0];
      UpdateMyANSPServices();
      UpdateMyShareTotalRevenue();
      UpdateMyCurrencyParameters();
      UpdateMyChartIncome1();
      UpdateMyChartIncome2();
      UpdateMyTableIncome();
      // UpdateMyChartIncome3();
      UpdateMyChartBalance1();
      UpdateMyChartBalance2();
      UpdateMyTableBalance();
      UpdateMyChartBalance3();
      UpdateMyPieChartBalance();
      // UpdateMyChartBalance4();
      UpdateMyChartCash1();
      UpdateMyChartCash2();
      UpdateMyTableCash();
      UpdateMyTableFreeCash();
      // UpdateMyChartCash3();
      UpdateTitles();
    }

   //------------------------Year Picker--------------------------------------------
   YearPicker = new google.visualization.ControlWrapper({
    controlType: "CategoryFilter",
    containerId: "YearPicker_div",
    dataTable: Data,
    state: { selectedValues: [SelectedYear] },
    options: {
     filterColumnLabel: "Year",
     ui: {
      label: "",
      caption: "",
      cssClass: "googlefilter",
      //						labelStacking: 'vertical',
      allowTyping: false,
      allowMultiple: false,
      sortValues: true,
      allowNone: false
     }
    }
   });
   YearPicker.draw();
   google.visualization.events.addListener(
    YearPicker,
    "statechange",
    changeYearPicker
   );

   function changeYearPicker() {
    SelectedYear = YearPicker.getState().selectedValues[0];
    UpdateMyANSPServices();
    UpdateMyShareTotalRevenue();
    UpdateMyCurrencyParameters();
    UpdateTitles();
    UpdateMyTableIncome();
    UpdateMyTableBalance();
    UpdateMyPieChartBalance();
    UpdateMyTableCash();
    UpdateMyTableFreeCash();
    
   }
  
    //---------------------------MyChart/TableX initialization ---------------------------------------------
    MyPieShareRevenue = new google.visualization.PieChart(document.getElementById("MyPieShareRevenue_div"));

    MyChartIncome1 = new google.visualization.ComboChart(document.getElementById("MyChartIncome1_div"));
    MyChartIncome2 = new google.visualization.ComboChart(document.getElementById("MyChartIncome2_div"));
    MyTableIncome = new google.visualization.Table(document.getElementById("MyTableIncome_div"));

    MyChartBalance1 = new google.charts.Bar(document.getElementById('MyChartBalance1_div'));
    MyChartBalance2 = new google.visualization.ComboChart(document.getElementById("MyChartBalance2_div"));
    MyTableBalance = new google.visualization.Table(document.getElementById("MyTableBalance_div"));
    MyChartBalance3 = new google.visualization.ComboChart(document.getElementById("MyChartBalance3_div"));
    MyPieChartBalance = new google.visualization.PieChart(document.getElementById("MyPieChartBalance_div"));

    MyChartCash1 = new google.visualization.ComboChart(document.getElementById("MyChartCash1_div"));
    MyChartCash2 = new google.visualization.ComboChart(document.getElementById("MyChartCash2_div"));
    MyTableCash = new google.visualization.Table(document.getElementById("MyTableCash_div"));
    MyTableFreeCash = new google.visualization.Table(document.getElementById("MyTableFreeCash_div"));

    UpdateMyANSPServices();
    UpdateMyShareTotalRevenue();
    UpdateMyCurrencyParameters();
    UpdateMyChartIncome1();
    UpdateMyChartIncome2();
    UpdateMyTableIncome();
    // UpdateMyChartIncome3();
    UpdateMyChartBalance1();
    UpdateMyChartBalance2();
    UpdateMyTableBalance();
    UpdateMyChartBalance3();
    UpdateMyPieChartBalance();
    // UpdateMyChartBalance4();
    UpdateMyChartCash1();
    UpdateMyChartCash2();
    UpdateMyTableCash();
    UpdateMyTableFreeCash();
    // UpdateMyChartCash3();
    UpdateTitles();
  }

     //---------------------------Services table ---------------------------------------------
 function UpdateMyANSPServices() {
    MyViewANSPServices = new google.visualization.DataView(Data);
    MyViewANSPServices.setRows(
      Data.getFilteredRows([{ column: 0, value: SelectedYear }])
    );
    MyViewANSPServices.setRows(
      Data.getFilteredRows([{ column: 1, value: SelectedEntity }])
    );
    MyViewANSPServices.setColumns([52, 53, 55, 56, 57, 51]);
 }

  //---------------------------Share of revenue piechart ---------------------------------------------
 function UpdateMyShareTotalRevenue() {
    MyViewShareTotalRevenue = new google.visualization.DataView(Data);
    MyViewShareTotalRevenue.setRows(
     Data.getFilteredRows([{ column: 0, value: SelectedYear }])
    );
    MyViewShareTotalRevenue.setRows(
     Data.getFilteredRows([{ column: 1, value: SelectedEntity }])
    );
    MyViewShareTotalRevenue.setColumns([59]);

   // Transpose table
    MyTableShareTotalRevenue = new google.visualization.DataTable();
   // Add first column
    MyTableShareTotalRevenue.addColumn('string', '');
    // Convert column labels to row labels
    var label = MyViewShareTotalRevenue.getColumnLabel(0);
    MyTableShareTotalRevenue.addRow([label]);
    MyTableShareTotalRevenue.addRow(['']);
  // Add two columns
    MyTableShareTotalRevenue.addColumn('number', '');
    // MyTableShareTotalRevenue.addColumn('number', '');
  //Add values to table
    MyTableShareTotalRevenue.setValue(0, 1, MyViewShareTotalRevenue.getValue(1, 0));
    MyTableShareTotalRevenue.setValue(1, 1, 1- MyViewShareTotalRevenue.getValue(1, 0));
  // alert(MyTableShareTotalRevenue.getValue(0, 2));

  var optionsMyPieShareRevenue = {
    //  title: "Share of Total Revenue (" + Math.round(MyTableShareTotalRevenue.getValue(0, 1)*1000)/10 + "%)",
    titleTextStyle: {

    },
     legend: {
      //  position: "labeled",
       position: 'none',
       textStyle: { fontSize: 11 },
       maxLines: 2,
       alignment: 'center',
       format: ''
       // maxLines = 2,
     },
     animation: {
       duration: 200,
       easing: "inAndOut"
     },
     slices: {
       0: {
         color: '#161b21',
         offset: 0.2,
        //  textStyle: { color: 'black' }
       },
       1: { color: '#c8c8c8' }
     },
     pieSliceText: 'none',
     pieSliceTextStyle: {
       fontSize: 10,
       bold: true,
     },
     tooltip: {
       trigger: 'none',
       textStyle: { fontSize: 12, },
     },
     width: 180,
     height: 83,
     chartArea: {
       left: 15,
       top: 12,
      //  width: "100%",
       height: "100%"
     }
   };
   MyPieShareRevenue.draw(MyTableShareTotalRevenue, optionsMyPieShareRevenue);
}

  //---------------------------Currency Parameters & data availability & Number of Decimals ----------------------
  function UpdateMyCurrencyParameters() {
    var MyViewCurrencyParameters = new google.visualization.DataView(Data);
    MyViewCurrencyParameters.setRows(
      Data.getFilteredRows([{ column: 0, value: SelectedYear }, { column: 1, value: SelectedEntity }])
     );

    MyViewCurrencyParameters.setColumns([38, 39, 40, 50, 60]);
    NatCurrency = MyViewCurrencyParameters.getValue(0, 0);
    XRate = MyViewCurrencyParameters.getValue(0, 1);
    
    CurrMultiplier = MyViewCurrencyParameters.getValue(0, 2);

    switch (CurrMultiplier) {
      case 1:
        CurrMultiplierString = 'M';
      break;
      case 1000:
        CurrMultiplierString = "B";
      break;
      case 0.001:
        CurrMultiplierString = "'000";
      break;
    }
    
    DataFlag = MyViewCurrencyParameters.getValue(0, 3);
    if (DataFlag != 1) {
      alert('Data for ' + SelectedEntity + ' for ' + SelectedYear + ' not yet available.')
    };

    DecimalsDivisor = MyViewCurrencyParameters.getValue(0, 4);
  }

  //---------------------------MyChartIncome 1 update ---------------------------------------------
  function UpdateMyChartIncome1() {

    MyViewIncome1 = new google.visualization.DataView(Data);
    MyViewIncome1.setRows(
      Data.getFilteredRows([{ column: 1, value: SelectedEntity }])
    );

    //--- find out if ANSP is EBITDA exception
    var MyViewEBITDAException = new google.visualization.DataView(Data);
    MyViewEBITDAException.setRows(
      Data.getFilteredRows([{ column: 0, value: SelectedYear }, { column: 1, value: SelectedEntity }])
    );
    MyViewEBITDAException.setColumns([37]);
    EbitdaException = MyViewEBITDAException.getValue(0,0);

    //--- Change headers of MiViewIncome1 if EbitdaException=1
    if (EbitdaException == 1) {
       var MyTableEBITDAException = new google.visualization.DataTable();
        MyTableEBITDAException = MyViewIncome1.toDataTable();
        
        MyTableEBITDAException.setColumnLabel(4,'Not EBITDA');
        MyTableEBITDAException.setColumnLabel(35,'EBITDA');

        MyViewIncome1 = new google.visualization.DataView(MyTableEBITDAException);
    };

    //--- find out column index of selected metrics
    ColIdx1 = null; ColIdx2 = null; ColIdx3 = null; j = 0;
    for (var x = 0; x < MyViewIncome1.getNumberOfColumns(); x++) {
      if (SelectedMetricIncome1[0] == MyViewIncome1.getColumnLabel(x)) {
        var ColIdx1 = x;
        j = j + 1;
      };
      if (SelectedMetricIncome1[1] == MyViewIncome1.getColumnLabel(x)) {
        var ColIdx2 = x; 
        j = j + 1;
      };
      if (SelectedMetricIncome1[2] == MyViewIncome1.getColumnLabel(x)) {
        var ColIdx3 = x;
        j = j + 1;
      };
    };

     //--- Select columns depending on number of metric selected  
    switch (j) {
      case 1:
        if (ColIdx1 == null) {
          if (ColIdx2 == null) {
            MyViewIncome1.setColumns([0, ColIdx3]);
          } else { MyViewIncome1.setColumns([0, ColIdx2])
          }
        } else {
            MyViewIncome1.setColumns([0, ColIdx1])
        };       
      break;
      case 2:
        if (ColIdx1 == null) {
          ArrayIndexes = [0, ColIdx2, ColIdx3];
          ArrayIndexes.sort();
          MyViewIncome1.setColumns(ArrayIndexes);
        } else {
          if (ColIdx2 == null) {
           ArrayIndexes = [0, ColIdx1, ColIdx3];
           ArrayIndexes.sort();
           MyViewIncome1.setColumns(ArrayIndexes);
        } else {
           ArrayIndexes = [0, ColIdx1, ColIdx2];
           ArrayIndexes.sort();
           MyViewIncome1.setColumns(ArrayIndexes);
         }
      }
      break;
      case 3:
       ArrayIndexes = [0, ColIdx1, ColIdx2, ColIdx3];
       ArrayIndexes.sort();
       MyViewIncome1.setColumns(ArrayIndexes);
      break;
  }

    // find out minimum year. This value is used in other parts of the dashboard
    MinYear = MyViewIncome1.getValue(0, 0);
      for (var x = 0; x < MyViewIncome1.getNumberOfRows(); x++) {
      if (MyViewIncome1.getValue(x, 0) < MinYear) {
        MinYear = MyViewIncome1.getValue(x, 0);
     }
    }

    var optionsMyChartIncome1 = {
      // title: SelectedEntity,
      titlePosition: "out",
      // width: 450,
      height: 210,
      pointSize: 3,
      backgroundColor: "#e4e8ed",
      series: {
        0: {
          type: "bars",
          color: "#00b0df",
          targetAxisIndex: 0
        },
        1: {
          type: "bars",
          color: "#161b21",
          targetAxisIndex: 0
        },
        2: {
          type: "bars",
          color: "#0072e3",
          targetAxisIndex: 0
        }
      },
      hAxis: {
        format: "####",
        textPosition: "out",
        textStyle: { color: "#595959", fontSize: 12 },
        // gridlines: "{ count: MyViewIncome1.getNumberOfRows() }"
        gridlines: { count: 0 }
      },
      vAxes: {
        0: {
          format: "#,###",
          textStyle: { color: "#595959", fontSize: 12 },
          title: "Revenues & Costs (" + NatCurrency + " " + CurrMultiplierString + ")",
          titleTextStyle: { italic: false, bold: true, color: "#595959", fontSize: 12 }
        }
        //   1: { format: "#%" }
      },
      legend: {
        position: "bottom",
        alignment: "center",
        textStyle: { color: "#595959", fontSize: 12 }
      },
      annotations: { titleTextStyle: {fontSize: 11, }},
      animation: {
        duration: 200,
        easing: "inAndOut"
      },
      chartArea: {
        left: 70,
        bottom: 40,
        width: "80%",
        height: "75%"
      }
    };
    MyChartIncome1.draw(MyViewIncome1, optionsMyChartIncome1);
  }

  //---------------------------MyChartIncome 2 update ---------------------------------------------
  function UpdateMyChartIncome2() {
    MyViewIncome2 = new google.visualization.DataView(Data);
    MyViewIncome2.setRows(
      Data.getFilteredRows([{ column: 1, value: SelectedEntity }])
    );
    
    //--- Select column for EBITDA Margin depending on EbitdaException and change header
    if (EbitdaException == 1) {
      var MyTableEBITDAException = new google.visualization.DataTable();
      MyTableEBITDAException = MyViewIncome2.toDataTable();

      MyTableEBITDAException.setColumnLabel(9, 'Not EBITDA Margin');
      MyTableEBITDAException.setColumnLabel(36, 'EBITDA Margin');

      MyViewIncome2 = new google.visualization.DataView(MyTableEBITDAException);

      var EBITDAMarginColumn = 36;
    } else {
      var EBITDAMarginColumn = 9;
    };

    MyViewIncome2.setColumns([
      0,
      EBITDAMarginColumn, {calc: "stringify", sourceColumn: EBITDAMarginColumn, type: "string", role: "annotation"},
      10, { calc: "stringify", sourceColumn: 10, type: "string", role: "annotation" },
      // 11, { calc: "stringify", sourceColumn: 11, type: "string", role: "annotation" },
      12, { calc: "stringify", sourceColumn: 12, type: "string", role: "annotation" },
    ]);

    var optionsMyChartIncome2 = {
      // title: SelectedEntity,
      titlePosition: "out",
      // width: 410,
      height: 405,
      pointSize: 3,
      backgroundColor: "#e4e8ed",
      // bar: { groupWidth: '80%' },
      series: {
        0: {
          type: "bars",
          color: "#f8982d",
          targetAxisIndex: 0
        },
        1: {
          type: "bars",
          color: "#c03200",
          targetAxisIndex: 0
        },
        2: {
          type: "bars",
          color: "#161b21", 
          targetAxisIndex: 0
        },
        // 3: {
        //   type: "bars",
        //   color: "#00895e",
        //   targetAxisIndex: 0
        // }
      },
      hAxis: {
        format: "####",
        textPosition: "out",
        textStyle: { color: "#595959", fontSize: 12 },
        // gridlines: "{ count: MyViewIncome2.getNumberOfRows() }",
        gridlines: { count: 0 }
      },
      vAxes: {
        0: {
          format: "#%",
          textStyle: { color: "#595959", fontSize: 12 },
          title: "Profit margin % (/Revenue)",
          titleTextStyle: { italic: false, bold: true, color: "#595959", fontSize: 12 }
        }
        //   1: { format: "#%" }
      },
      legend: {
        position: "bottom",
        // maxLines: 2,
        alignment: "left",
        textStyle: { color: "#595959", fontSize: 12 }
      },
      animation: {
        duration: 200,
        easing: "inAndOut"
      },
      chartArea: {
        //   left: 40,
        //   top: 40,
        width: "80%",
        height: "70%"
      }
    };
    MyChartIncome2.draw(MyViewIncome2, optionsMyChartIncome2);
  }
  //---------------------------MyTableIncome update ---------------------------------------------
  function UpdateMyTableIncome() {
    MyViewTableIncome = new google.visualization.DataView(Data);
    MyViewTableIncome.setRows(
      Data.getFilteredRows([{ column: 1, value: SelectedEntity }])
    );
    
    //--- Select column for EBITDA depending on EbitdaException and change header
    if (EbitdaException == 1) {
      var MyTableEBITDAException = new google.visualization.DataTable();
      MyTableEBITDAException = MyViewTableIncome.toDataTable();

      MyTableEBITDAException.setColumnLabel(4, 'Not EBITDA');
      MyTableEBITDAException.setColumnLabel(35, 'EBITDA');

      MyViewTableIncome = new google.visualization.DataView(MyTableEBITDAException);

      var EBITDAColumn = 35;
    } else {
      var EBITDAColumn = 4;
    };


    MyViewTableIncome.setColumns([0, 2, 3, EBITDAColumn, 5, 32, 6, 7, 8]);

    // Transpose table
    TransposedTable = new google.visualization.DataTable();
    // Add first column from original datatable
    TransposedTable.addColumn('string', '');
    // Convert column labels to row labels
    for (var x = 1; x < MyViewTableIncome.getNumberOfColumns(); x++) {
      var label = MyViewTableIncome.getColumnLabel(x) == "EBIT"? "Operating income (EBIT)" : MyViewTableIncome.getColumnLabel(x);
      TransposedTable.addRow([label]);
    }
    // Convert row labels and data to columns
    for (var x = 0; x < MyViewTableIncome.getNumberOfRows(); x++) {
      TransposedTable.addColumn('number', MyViewTableIncome.getValue(x, 0)); // Use first column date as label
      for (var y = 1; y < MyViewTableIncome.getNumberOfColumns(); y++) {
        TransposedTable.setValue(y - 1, x + 1, MyViewTableIncome.getValue(x, y));
      }
    }
    // add last column comparing selected year v selected year-1
    TransposedTable.addColumn('number', TransposedTable.getColumnLabel(SelectedYear - MinYear + 1) + '/' + TransposedTable.getColumnLabel(SelectedYear - MinYear));
    for (var z = 0; z < TransposedTable.getNumberOfRows(); z++) {
      // alert(TransposedTable.getValue(z, x));
      if (TransposedTable.getValue(z, SelectedYear - MinYear) == 0) {
        TransposedTable.setValue(z, x + 1, 0);
      }
       else { 
        var YoYVariation = (z==1 || z==3 || z==4)? (-TransposedTable.getValue(z, SelectedYear - MinYear + 1)/ (-TransposedTable.getValue(z, SelectedYear - MinYear)))-1 : (TransposedTable.getValue(z, SelectedYear - MinYear + 1) - TransposedTable.getValue(z, SelectedYear - MinYear)) / Math.abs(TransposedTable.getValue(z, SelectedYear - MinYear)); 
        TransposedTable.setValue(z, x + 1, YoYVariation) }
    }

    var cssClassNames = {
      'headerRow': 'MyTableHeader',
      'headerCell': 'MyHeaderCell',
      'tableCell': 'MyTableCell',
    };
    var options = { alternatingRowStyle: false, 'allowHtml': true, 'cssClassNames': cssClassNames, sort: 'disable', width: 580 };
    TransposedTable.setRowProperty(2, "className", "font-weight-bold");
    TransposedTable.setRowProperty(5, "className", "font-weight-bold");
    TransposedTable.setRowProperty(7, "className", "font-weight-bold");

    // Choose number of decimals for presentation
    switch (DecimalsDivisor) {
      case 1:
        MyPattern = '#,##0;(#,##0);0';
      break;
      case 10:
        MyPattern = '#,##0.0;(#,##0.0);0';
      break;
      case 100:
        MyPattern = '#,##0.00;(#,##0.00);0';
      break;
  }

    var formatter1 = new google.visualization.NumberFormat(
      { prefix: '', negativeColor: 'red', pattern: MyPattern });
    var formatter2 = new google.visualization.NumberFormat(
      { prefix: '', pattern: '+0.0%;-0.0%' });

    for (var i = 1; i < TransposedTable.getNumberOfColumns() - 1; i++) {
      formatter1.format(TransposedTable, i);
    }
    formatter2.format(TransposedTable, i)
    TransposedTable.setColumnProperty(i, "className", "font-italic");
    // tempTable.setColumnProperty(2, "className", "Mybluedata");
    // tempTable.setProperty(0, 2, "className", "MyTableHeader");
    MyTableIncome.draw(TransposedTable, options);
  }

   //------------------------FButtons year--------------------------------------------
  // function FButtonYear() {
  //   SelectedYear = PassYear;
  //   switch (PassYear) {
  //     case 2019:
  //       Button2019.className = 'btn btn-dark btn-sm font-weight-bold';
  //       Button2018.className = 'btn btn-secondary btn-sm';
  //       Button2017.className = 'btn btn-secondary btn-sm';
  //       // Button2016.className = 'btn btn-secondary btn-sm';
  //       // Button2015.className = 'btn btn-secondary btn-sm';
  //       MyBarColor = '#6d9eeb';
  //     break;
  //     case 2018:
  //       Button2019.className = 'btn btn-secondary btn-sm';
  //       Button2018.className = 'btn btn-dark btn-sm font-weight-bold';
  //       Button2017.className = 'btn btn-secondary btn-sm';
  //       // Button2016.className = 'btn btn-secondary btn-sm';
  //       // Button2015.className = 'btn btn-secondary btn-sm';
  //       MyBarColor = '#3c78d8'; //colour when 5 years #6d87eb
  //     break;
  //     case 2017:
  //       Button2019.className = 'btn btn-secondary btn-sm';
  //       Button2018.className = 'btn btn-secondary btn-sm';
  //       Button2017.className = 'btn btn-dark btn-sm font-weight-bold';
  //       // Button2016.className = 'btn btn-secondary btn-sm';
  //       // Button2015.className = 'btn btn-secondary btn-sm';
  //       MyBarColor = '#1c4587'; //colour when 5 years #3c78d8
  //     break;
  //   }
  //   // SelectedYear = parseInt(document.getElementById('Button2019').value);
  //   // UpdateMyChartIncome3();
  //   UpdateMyTableIncome();
  //   UpdateMyChartBalance4();
  //   UpdateMyTableBalance();
  //   UpdateMyChartCash3();
  //   UpdateMyPieChartBalance();
  //   UpdateMyTableCash();
  //   UpdateMyTableFreeCash();
  //   UpdateTitles();
  //   YearPicker.setState({ selectedValues: [SelectedYear] });
  //   YearPicker.draw();
  // }

  //------------------------FButtons Metric--------------------------------------------
  function FButtonMetric1() {

    switch (PassMetric1) {
      case 'Revenue':
        x = 0; // Is Selected metric already selected?
        y = 0; // position of last null
        z = 0; // number of nulls
        for (i = 1; i < 4; i++) {
          if (SelectedMetricIncome1[i-1] == PassMetric1) {x=i};
          if (SelectedMetricIncome1[i-1] == null) {y=i; z=z+1};
        };
        if (x!=0 && z!=2) {
          ButtonRevenue1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
          SelectedMetricIncome1[x - 1] = null
        };
        if (x==0 ) {
          if (y != 0) {
            ButtonRevenue1.className = 'btn btn-dark btn-sm pb-0 pt-0 font-weight-bold';
            SelectedMetricIncome1[y - 1] = PassMetric1
          } else {
            switch (SelectedMetricIncome1[2]) {
              case 'Revenue':
                ButtonRevenue1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'Opex':
                ButtonOPEX1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'EBITDA':
                ButtonEBITDA1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'Depreciation and amortisation':
                ButtonDepAmo1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'EBIT':
                ButtonEBIT1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'Pre-tax profit':
                ButtonPTP1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
            };
            ButtonRevenue1.className = 'btn btn-dark btn-sm pb-0 pt-0 font-weight-bold'; 
            SelectedMetricIncome1[2] = PassMetric1
          }
          }
        break;
      case 'Opex':
        x = 0; y = 0; z = 0;
        for (i = 1; i < 4; i++) {
          if (SelectedMetricIncome1[i - 1] == PassMetric1) {x = i};
          if (SelectedMetricIncome1[i - 1] == null) { y = i; z = z + 1 };
        };
        if (x != 0 && z != 2) {
          ButtonOPEX1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
          SelectedMetricIncome1[x - 1] = null
        };
        if (x == 0) {
          if (y != 0) {
            ButtonOPEX1.className = 'btn btn-dark btn-sm pb-0 pt-0 font-weight-bold';
            SelectedMetricIncome1[y - 1] = PassMetric1
          } else {
            switch (SelectedMetricIncome1[2]) {
              case 'Revenue':
                ButtonRevenue1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'Opex':
                ButtonOPEX1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'EBITDA':
                ButtonEBITDA1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'Depreciation and amortisation':
                ButtonDepAmo1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'EBIT':
                ButtonEBIT1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'Pre-tax profit':
                ButtonPTP1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
            };
            ButtonOPEX1.className = 'btn btn-dark btn-sm pb-0 pt-0 font-weight-bold';
            SelectedMetricIncome1[2] = PassMetric1 
          }
        }
        break;
      case 'EBITDA':
        x = 0; y = 0; z = 0;
        for (i = 1; i < 4; i++) {
          if (SelectedMetricIncome1[i - 1] == PassMetric1) {x = i};
          if (SelectedMetricIncome1[i - 1] == null) { y = i; z = z + 1 };
        };
        if (x != 0 && z != 2) {
          ButtonEBITDA1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
          SelectedMetricIncome1[x - 1] = null
        };
        if (x == 0) {
          if (y != 0) {
            ButtonEBITDA1.className = 'btn btn-dark btn-sm pb-0 pt-0 font-weight-bold';
            SelectedMetricIncome1[y - 1] = PassMetric1
          } else {
            switch (SelectedMetricIncome1[2]) {
              case 'Revenue':
                ButtonRevenue1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'Opex':
                ButtonOPEX1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'EBITDA':
                ButtonEBITDA1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'Depreciation and amortisation':
                ButtonDepAmo1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'EBIT':
                ButtonEBIT1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'Pre-tax profit':
                ButtonPTP1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
            };
            ButtonEBITDA1.className = 'btn btn-dark btn-sm pb-0 pt-0 font-weight-bold';
            SelectedMetricIncome1[2] = PassMetric1 
          }
        }
        break;
      case 'Depreciation and amortisation':
        x = 0; // Is Selected metric already selected?
        y = 0; // position of last null
        z = 0; // number of nulls
        for (i = 1; i < 4; i++) {
          if (SelectedMetricIncome1[i - 1] == PassMetric1) {x = i};
          if (SelectedMetricIncome1[i - 1] == null) { y = i; z = z + 1 };
        };
        if (x != 0 && z != 2) {
          ButtonDepAmo1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
          SelectedMetricIncome1[x - 1] = null
        };
        if (x == 0) {
          if (y != 0) {
            ButtonDepAmo1.className = 'btn btn-dark btn-sm pb-0 pt-0 font-weight-bold';
            SelectedMetricIncome1[y - 1] = PassMetric1
          } else { 
            switch (SelectedMetricIncome1[2]) {
              case 'Revenue':
                ButtonRevenue1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'Opex':
                ButtonOPEX1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'EBITDA':
                ButtonEBITDA1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'Depreciation and amortisation':
                ButtonDepAmo1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'EBIT':
                ButtonEBIT1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'Pre-tax profit':
                ButtonPTP1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
            };
            ButtonDepAmo1.className = 'btn btn-dark btn-sm pb-0 pt-0 font-weight-bold';
            SelectedMetricIncome1[2] = PassMetric1;
          }
        }
        break;
      case 'EBIT':
        x = 0; y = 0; z = 0;
        for (i = 1; i < 4; i++) {
          if (SelectedMetricIncome1[i - 1] == PassMetric1) {x = i};
          if (SelectedMetricIncome1[i - 1] == null) { y = i; z = z + 1 };
        };
        if (x != 0 && z != 2) {
          ButtonEBIT1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
          SelectedMetricIncome1[x - 1] = null
        };
        if (x == 0) {
          if (y != 0) {
            ButtonEBIT1.className = 'btn btn-dark btn-sm pb-0 pt-0 font-weight-bold';
            SelectedMetricIncome1[y - 1] = PassMetric1
          } else {
            switch (SelectedMetricIncome1[2]) {
              case 'Revenue':
                ButtonRevenue1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'Opex':
                ButtonOPEX1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'EBITDA':
                ButtonEBITDA1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'Depreciation and amortisation':
                ButtonDepAmo1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'EBIT':
                ButtonEBIT1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'Pre-tax profit':
                ButtonPTP1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
            };
            ButtonEBIT1.className = 'btn btn-dark btn-sm pb-0 pt-0 font-weight-bold';
            SelectedMetricIncome1[2] = PassMetric1 
          }
        }
        break;
      case 'Pre-tax profit':
        x = 0; y = 0; z = 0;
        for (i = 1; i < 4; i++) {
          if (SelectedMetricIncome1[i - 1] == PassMetric1) {x = i};
          if (SelectedMetricIncome1[i - 1] == null) { y = i; z = z + 1 };
        };
        if (x != 0 && z != 2) {
          ButtonPTP1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
          SelectedMetricIncome1[x - 1] = null
        };
        if (x == 0) {
          if (y != 0) {
            ButtonPTP1.className = 'btn btn-dark btn-sm pb-0 pt-0 font-weight-bold';
            SelectedMetricIncome1[y - 1] = PassMetric1
          } else {
            switch (SelectedMetricIncome1[2]) {
              case 'Revenue':
                ButtonRevenue1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'Opex':
                ButtonOPEX1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'EBITDA':
                ButtonEBITDA1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'Depreciation and amortisation':
                ButtonDepAmo1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'EBIT':
                ButtonEBIT1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'Net financial income/expense':
                ButtonNetFinIE1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
              case 'Pre-tax profit':
                ButtonPTP1.className = 'btn btn-secondary btn-sm pb-0 pt-0';
                break;
            };
            ButtonPTP1.className = 'btn btn-dark btn-sm pb-0 pt-0 font-weight-bold';
            SelectedMetricIncome1[2] = PassMetric1 
          }
        }
        break;
    }
    UpdateMyChartIncome1();
  }


  //---------------------------MyChartBalance 1 update ---------------------------------------------
  function UpdateMyChartBalance1() {
    MyViewBalance1 = new google.visualization.DataView(Data);
    MyViewBalance1.setRows(
      Data.getFilteredRows([{ column: 1, value: SelectedEntity }])
    );
    MyViewBalance1.setColumns([0, 14, 13, 16, 17, 18]);
    //Check negative values
    for (var y = 1; y < MyViewBalance1.getNumberOfColumns(); y++) {
      var NegativeValues_Balance
      if (MyViewBalance1.getValue(SelectedYear - MinYear, y) < 0) {
        NegativeValues_Balance = 1
      };
    } 

    // Set chart options
    var optionsMyChartBalance1 = {
      isStacked: true,
      bars: 'horizontal',
      backgroundColor: "#e4e8ed",
      chart: {
        // title: 'Some title',
        // titleTextStyle: { italic: false, color: "#595959", fontSize: 11 }
      },
      vAxes: {
        0:{  
          title: " ",
          format: "####",
          textPosition: "out",
          textStyle: { color: "#595959", fontSize: 12 },
        },
      1: {
          format: "-",
          textStyle: { color: "#595959", fontSize: 0 },
          gridlines: { count: 0 }
        },
      },
      hAxes: {
        0: {
          format: "####",
          textStyle: { color: "#595959", fontSize: 12 },
          title: "Assets & Liabilities (" + NatCurrency + " " + CurrMultiplierString + ")",
          titleTextStyle: { italic: false, bold: true, color: "#595959", fontSize: 12 },
          gridlines: { color: "#b4b4b4" },
        },
        1: {
          format: "-",
          textStyle: { color: "#595959", fontSize: 0 },
          gridlines: { count: 0 },          
        }
      },
      series: {
        0: {
          targetAxisIndex: 0,
          color: "#00b0df",
        },
        1: {
          targetAxisIndex: 0,
          color: "#0072e3",
        },
        2: {
          targetAxisIndex: 1,
          color: "#161b21"
        },
        3: {
          targetAxisIndex: 1,
          color: "#94982d"
        },
        4: {
          targetAxisIndex: 1,
          color: "#00895e"
        }
      },
      legend: {
        // alignment: "center",
        // position: "top", // doesn't work for this chart
        textStyle: { color: "#595959", fontSize: 12 }
      },
      animation: {
        duration: 200,
        easing: "inAndOut"
      },
      // width: 500, //set it to 710 by 210 if bars vertical
      height: 280,
      chartArea: {
        backgroundColor: "#e4e8ed",
        //   left: 40, //none of this works for this type of chart
        //   top: 40,
        // left: 100,
        // width: "100%",
        // height: "80%"
      }
    };

    // No chart if negative values 
    if (NegativeValues_Balance == 1) {
        document.getElementById("MyChartBalance1_div").innerHTML = "Chart not available.";
        MyChartBalance1 = new google.charts.Bar(document.getElementById('MyChartBalance1_div'));
      }
    else {
      // Instantiate and draw our chart, passing in some options.
      MyChartBalance1.draw(MyViewBalance1, google.charts.Bar.convertOptions(optionsMyChartBalance1));
      }

  //---------------------------MyChartBalance 2 update ---------------------------------------------
  function UpdateMyChartBalance2() {
    MyViewBalance2 = new google.visualization.DataView(Data);
    MyViewBalance2.setRows(
      Data.getFilteredRows([{ column: 1, value: SelectedEntity }])
    );
    MyViewBalance2.setColumns([0, 21, 22, { calc: "stringify", sourceColumn: 22, type: "string", role: "annotation"}]);

    var optionsMyChartBalance2 = {
      // title: SelectedEntity,
      titlePosition: "out",
      // width: 410,
      height: 300,
      pointSize: 3,
      backgroundColor: "#e4e8ed",
      series: {
        0: {
          type: "bars",
          color: "#002060",
          targetAxisIndex: 0,
        },
        1: {
          type: "line",
          color: "#00895e",
          lineWidth: 3,
          pointSize: 8,
          targetAxisIndex: 1
        },
      },
      hAxis: {
        format: "####",
        textPosition: "out",
        textStyle: { color: "#595959", fontSize: 12 },
        gridlines: { count: 0 }
      },
      vAxes: {
        0: {
          format: "#,###",
          textStyle: { color: "#595959", fontSize: 12 },
          title: "Cash & Equivalents (" + NatCurrency + " " + CurrMultiplierString + ")",
          titleTextStyle: { italic: false, bold: true, color: "#595959", fontSize: 12 },
          minValue: 0,
        },
        1: {
          format: "#",
          textStyle: { color: "#595959", fontSize: 12 },
          title: 'Cash-on-hand days',
          titleTextStyle: { italic: false, bold: true, color: "#595959", fontSize: 12 },
          gridlines: { count: 0 },
          minValue: 0,
        }
      },
      legend: {
        position: "bottom",
        alignment: "center",
        textStyle: { color: "#595959", fontSize: 12 }
      },
      animation: {
        duration: 200,
        easing: "inAndOut"
      },
      chartArea: {
        //   left: 40,
        bottom: 50,
        width: "75%",
        height: "70%"
      }
    };
    MyChartBalance2.draw(MyViewBalance2, optionsMyChartBalance2);
  }

  //---------------------------MyTableBalance update ---------------------------------------------
  function UpdateMyTableBalance() {
    MyViewTableBalance = new google.visualization.DataView(Data);
    MyViewTableBalance.setRows(
      Data.getFilteredRows([{ column: 1, value: SelectedEntity }])
    );
    MyViewTableBalance.setColumns([0, 13, 14, 15, 16, 18, 17, 19]);

    // Transpose table
    TransposedTableBalance = new google.visualization.DataTable();
    // Add first column from original datatable
    TransposedTableBalance.addColumn('string', '');
    // Convert column labels to row labels
    for (var x = 1; x < MyViewTableBalance.getNumberOfColumns(); x++) {
      var label = MyViewTableBalance.getColumnLabel(x);
      TransposedTableBalance.addRow([label]);
    }
    // Convert row labels and data to columns
    for (var x = 0; x < MyViewTableBalance.getNumberOfRows(); x++) {
      TransposedTableBalance.addColumn('number', MyViewTableBalance.getValue(x, 0)); // Use first column date as label
      for (var y = 1; y < MyViewTableBalance.getNumberOfColumns(); y++) {
        TransposedTableBalance.setValue(y - 1, x + 1, MyViewTableBalance.getValue(x, y));
      }
    }
    // Replace last row 'total liabilities' by Equity and liabilities
    TransposedTableBalance.setValue(TransposedTableBalance.getNumberOfRows() - 1, 0, 'Liabilities & Equity');
    for (var y = 1; y < TransposedTableBalance.getNumberOfColumns(); y++) {
      TransposedTableBalance.setValue(TransposedTableBalance.getNumberOfRows() - 1, y, TransposedTableBalance.getValue(TransposedTableBalance.getNumberOfRows() - 1, y) + TransposedTableBalance.getValue(TransposedTableBalance.getNumberOfRows() - 4, y));
    }

    // add last column comparing selected year v selected year-1
    TransposedTableBalance.addColumn('number',  TransposedTableBalance.getColumnLabel(SelectedYear - MinYear + 1) + '/' + TransposedTableBalance.getColumnLabel(SelectedYear - MinYear));
    for (var z = 0; z < TransposedTableBalance.getNumberOfRows(); z++) {
      // alert(TransposedTable.getValue(z, x));
      if (TransposedTableBalance.getValue(z, SelectedYear - MinYear) == 0) {
        TransposedTableBalance.setValue(z, x + 1, 0);
      }
      else { TransposedTableBalance.setValue(z, x + 1, (TransposedTableBalance.getValue(z, SelectedYear - MinYear + 1) - TransposedTableBalance.getValue(z, SelectedYear - MinYear)) / Math.abs(TransposedTableBalance.getValue(z, SelectedYear - MinYear))) }
    }

    var cssClassNames = {
      'headerRow': 'MyTableHeader',
      'headerCell': 'MyHeaderCell',
      'tableCell': 'MyTableCell',
    };
    var TableBalanceOptions = { alternatingRowStyle: false, 'allowHtml': true, 'cssClassNames': cssClassNames, sort: 'disable', width: 580 };
    TransposedTableBalance.setRowProperty(2, "className", "font-weight-bold");
    TransposedTableBalance.setRowProperty(6, "className", "font-weight-bold");

    var formatter1 = new google.visualization.NumberFormat(
      { prefix: '', negativeColor: 'red', pattern: MyPattern });
    var formatter2 = new google.visualization.NumberFormat(
      { prefix: '', pattern: '+0.0%;-0.0%' });

    for (var i = 1; i < TransposedTableBalance.getNumberOfColumns() - 1; i++) {
      formatter1.format(TransposedTableBalance, i);
    }
    formatter2.format(TransposedTableBalance, i)
    TransposedTableBalance.setColumnProperty(i, "className", "font-italic");
    MyTableBalance.draw(TransposedTableBalance, TableBalanceOptions);
  }

  //---------------------------MyChartBalance 3 update ---------------------------------------------
  function UpdateMyChartBalance3() {
    MyViewBalance3 = new google.visualization.DataView(Data);
    MyViewBalance3.setRows(
      Data.getFilteredRows([{ column: 1, value: SelectedEntity }])
    );
    MyViewBalance3.setColumns([0, 14, 17,
     20, { calc: "stringify", sourceColumn: 20, type: "string", role: "annotation" }]);

    var optionsMyChartBalance3 = {
      // title: SelectedEntity,
      titlePosition: "out",
      // width: 450,
      backgroundColor: "#e4e8ed",
      series: {
        0: {
          type: "bars",
          color: "#161b21",
          targetAxisIndex: 0
        },
        1: {
          type: "bars",
          color: "#00b0df",
          targetAxisIndex: 0
        },
        2: {
          type: "line",
          color: "#548235",
          lineWidth: 3,
          pointSize: 8,
          targetAxisIndex: 1
        }
      },
      hAxis: {
        format: "####",
        textPosition: "out",
        textStyle: { color: "#595959", fontSize: 12 },
        // slantedText: true,
        // slantedTextAngle: 90,
        // gridlines: "{ count: MyViewIncome1.getNumberOfRows() }"
        gridlines: { count: 0 }
      },
      vAxes: {
        0: {
          format: "#,###",
          textStyle: { color: "#595959", fontSize: 12 },
          title: "Current Assets & Liabilities (" + NatCurrency + " " + CurrMultiplierString + ")",
          titleTextStyle: { italic: false, bold: true, color: "#595959", fontSize: 12 },
          minValue: 0,
        },
        1: {
          format: "0.#",
          gridlines: { count: 0 },
          title: "Current Ratio",
          titleTextStyle: { italic: false, bold: true, color: "#595959", fontSize: 12 },
          minValue: 0,
        }
      },
      legend: {
        position: "bottom",
        alignment: "center",
        textStyle: { color: "#595959", fontSize: 12 }
      },
      animation: {
        duration: 200,
        easing: "inAndOut"
      },
      height: 345,
      chartArea: {
        //   left: 40,
        //   top: 40,
        width: "75%",
        height: "70%"
      }
    };
    MyChartBalance3.draw(MyViewBalance3, optionsMyChartBalance3);
  }

  //---------------------------MyPieChartBalance update ---------------------------------------------
  function UpdateMyPieChartBalance() {
    MyPieViewBalance = new google.visualization.DataView(Data);
    MyPieViewBalance.setRows(
      Data.getFilteredRows([{ column: 0, value: SelectedYear }, { column: 1, value: SelectedEntity }])
    );
    // alert(SelectedYear)
    MyPieViewBalance.setColumns([0, 19, 16]);

    // Transpose table
    MyPieTableBalance = new google.visualization.DataTable();
    // Add first column from original datatable
    MyPieTableBalance.addColumn('string', '');

    // Convert column labels to row labels
    for (var x = 1; x < MyPieViewBalance.getNumberOfColumns(); x++) {
      var label = MyPieViewBalance.getColumnLabel(x);
      if (label == 'Shareholders equity') {
       label = 'Shareholders Equity'
     };
      MyPieTableBalance.addRow([label]);
    }

    // Convert row labels and data to columns
    for (var x = 0; x < MyPieViewBalance.getNumberOfRows(); x++) {
      MyPieTableBalance.addColumn('number', MyPieViewBalance.getValue(x, 0)); // Use first column as label
      for (var y = 1; y < MyPieViewBalance.getNumberOfColumns(); y++) {
        MyPieTableBalance.setValue(y - 1, x + 1, Math.round(MyPieViewBalance.getValue(x, y)));
        var NegativeValues
        if (MyPieTableBalance.getValue(y - 1, x + 1) < 0) {
          NegativeValues = 1
        };
      }
    }

    var optionsMyPieChartBalance = {
      // // title: SelectedEntity,
      // titlePosition: "out",
      // // width: 450,
      // height: 210,
      legend: {
        position: "top",
        textStyle: { fontSize: 11},
        maxLines: 2,
        alignment: 'center',
        format: ''
        // maxLines = 2,
      },
      animation: {
        duration: 200,
        easing: "inAndOut"
      },
      slices: {
        0: {
          color: '#00b0bf',
          textStyle: { color: 'black' }
        },
        1: { color: '#161b21' }
      },
      pieSliceText: 'percentage',
      pieSliceTextStyle: {
        fontSize: 10,
        bold: true,
      },
      tooltip: { 
       trigger: 'hover', 
       textStyle: {fontSize: 12, },
      },
      width: 250,
      height: 150,
      chartArea: {
        left: 0,
        top: 40,
        width: "100%",
        height: "100%"
      }
    };
    
    if (NegativeValues == 1) {
      document.getElementById("MyPieChartBalance_div").innerHTML = "Chart not available.";
      MyPieChartBalance = new google.visualization.PieChart(document.getElementById("MyPieChartBalance_div"));
    }
    else {
      MyPieChartBalance.draw(MyPieTableBalance, optionsMyPieChartBalance);
    }
  }

    //---------------------------MyChartBalance4 draw ---------------------------------------------
  // function UpdateMyChartBalance4() {

  //   MyViewBalance4 = new google.visualization.DataView(Data);

  //   MyViewBalance4.setRows(
  //       Data.getFilteredRows([{ column: 0, value: SelectedYear }])
  //     );

  //     //--- find out column index of selected metric
  //   for (var x = 0; x < MyViewBalance4.getNumberOfColumns(); x++) {
  //     if (SelectedMetricBalance == MyViewBalance4.getColumnLabel(x)) {
  //       var ColIdx = x
  //     };
  //   };

  //   MyViewBalance4.setColumns([1, ColIdx]);

  //   var optionsMyChartBalance4 = {
  //     title: SelectedMetricBalance + " - " + SelectedYear,
  //     titlePosition: "none",
  //     pointSize: 3,
  //     backgroundColor: "#e4e8ed",
  //     series: {
  //       0: {
  //         type: "bars",
  //         color: MyBarColor,
  //         targetAxisIndex: 0
  //       }
  //     },
  //     hAxis: {
  //       // format: "####",
  //       textPosition: "out",
  //       textStyle: { color: "#595959", fontSize: 12 },
  //       slantedText: true,
  //       slantedTextAngle: 45,
  //       // maxTextLines: 2,
  //       // gridlines: "{ count: MyViewIncome1.getNumberOfRows() }"
  //       gridlines: { count: 0 }
  //     },
  //     vAxes: {
  //       0: {
  //         format: "#,###",
  //         textStyle: { color: "#595959", fontSize: 12 },
  //         title: SelectedMetricBalance + " (" + NatCurrency + " " + CurrMultiplierString + ")"",
  //         titleTextStyle: { italic: false, bold:true, color: "#595959", fontSize: 13 }
  //       }
  //       //   1: { format: "#%" }
  //     },
  //     legend: {
  //       position: "none"
  //     },
  //     animation: {
  //       duration: 200,
  //       easing: "inAndOut"
  //     },
  //     height: 360,
  //     chartArea: {
  //       bottom: 80,
  //       width: "85%",
  //       height: "70%"
  //     }
  //   };

  //   MyChartBalance4.draw(MyViewBalance4, optionsMyChartBalance4);
  //   SelectEntityInBalance4Chart();
  // }

//---------------------------MyChartCash 1 update ---------------------------------------------*****
  function UpdateMyChartCash1() {
    MyViewCash1 = new google.visualization.DataView(Data);
    MyViewCash1.setRows(
      Data.getFilteredRows([{ column: 1, value: SelectedEntity }]));

    switch (PassCashType) {
     case 'Absolute':
      ButtonCashAbs.className = 'btn btn-dark btn-sm font-weight-bold';
      ButtonCashPerc.className = 'btn btn-secondary btn-sm'; 
      MyViewCash1.setColumns([0, 25, 26, 33, 34]);
      var MyFormatVaxis = "#,###";
      var MyTitleVaxis = "Net Cash Flow (" + NatCurrency + " " + CurrMultiplierString + ")";
     break;
     
     case '% of Revenue':
      ButtonCashAbs.className = 'btn btn-secondary btn-sm';
      ButtonCashPerc.className = 'btn btn-dark btn-sm font-weight-bold';
      var MyFormatVaxis = "#%"
      var MyTitleVaxis = "Net Cash Flow %(/Revenue)";

      var MyViewCash1_extended = new google.visualization.DataView(MyViewCash1); 
      MyViewCash1_extended.setColumns([0, 2, 25, 26, 33, 34]);
      
      var MyTableCash1 = new google.visualization.DataTable();
      MyTableCash1 = MyViewCash1_extended.toDataTable();


      for (var x = 2; x < MyTableCash1.getNumberOfColumns(); x++) {
        for (var y = 0; y < MyTableCash1.getNumberOfRows(); y++) {
         MyTableCash1.setValue(y, x, MyTableCash1.getValue(y,x)/ MyTableCash1.getValue(y, 1));
         MyTableCash1.setFormattedValue(y, x, parseInt(Math.round(MyTableCash1.getValue(y, x)*100))+"%");
       }
      }

      MyTableCash1.removeColumn(1);
      // MyTableCash1.insertColumn(2);
      MyViewCash1 = new google.visualization.DataView(MyTableCash1);
     break;
    } 

   var optionsMyChartCash1 = {
      // title: SelectedEntity,
      titlePosition: "out",
      // width: 450,
      height: 260,
      pointSize: 3,
      backgroundColor: "#e4e8ed",
      series: {
        0: {
          type: "bars",
          color: "#00afdf",
          targetAxisIndex: 0
        },
        1: {
          type: "bars",
          color: "#0073e3",
          targetAxisIndex: 0
        },
        2: {
          type: "bars",
          color: "#003b72",
          targetAxisIndex: 0
        },
        3: {
          type: "bars",
          color: "#161b21", 
          targetAxisIndex: 0
        }
      },
      hAxis: {
        format: "####",
        textPosition: "out",
        textStyle: { color: "#595959", fontSize: 12 },
        // slantedText: true,
        // slantedTextAngle: 90,
        // gridlines: "{ count: MyViewIncome1.getNumberOfRows() }"
        gridlines: { count: 0 }
      },
      vAxes: {
        0: {
          format: MyFormatVaxis,
          textStyle: { color: "#595959", fontSize: 12 },
          title: MyTitleVaxis,
          titleTextStyle: { italic: false, bold: true, color: "#595959", fontSize: 12 }
        }
        //   1: { format: "#%" }
      },
      legend: {
        position: "right",
        alignment: "center",
        textStyle: { color: "#595959", fontSize: 12 }
      },
      animation: {
        duration: 200,
        easing: "inAndOut"
      },
      chartArea: {
        left: 60,
        bottom: 30,
        width: "65%",
        height: "75%"
      }
    };
    MyChartCash1.draw(MyViewCash1, optionsMyChartCash1);
  }

  //---------------------------MyChartCash2 update ---------------------------------------------
  function UpdateMyChartCash2() {
    MyViewCash2 = new google.visualization.DataView(Data);
    MyViewCash2.setRows(
      Data.getFilteredRows([{ column: 1, value: SelectedEntity }])
    );
 
    switch (PassCashType2) {
    case 'Absolute':
     ButtonCashAbs2.className = 'btn btn-dark btn-sm font-weight-bold';
     ButtonCashPerc2.className = 'btn btn-secondary btn-sm';
     MyViewCash2.setColumns([0, 25, 41, 27]);
     var MyFormatVaxis2 = "#,###";
     var MyTitleVaxis2 = "Free Cash Flow (" + NatCurrency + " " + CurrMultiplierString + ")";
     break;

    case '% of Revenue':
     ButtonCashAbs2.className = 'btn btn-secondary btn-sm';
     ButtonCashPerc2.className = 'btn btn-dark btn-sm font-weight-bold';
     var MyFormatVaxis2 = "#%"
     var MyTitleVaxis2 = "Net Cash Flow %(/Revenue)";

     var MyViewCash2_extended = new google.visualization.DataView(MyViewCash2);
     MyViewCash2_extended.setColumns([0, 2, 25, 41, 27]);

     var MyTableCash2_extended = new google.visualization.DataTable();
     MyTableCash2_extended = MyViewCash2_extended.toDataTable();


     for (var x = 2; x < MyTableCash2_extended.getNumberOfColumns(); x++) {
      for (var y = 0; y < MyTableCash2_extended.getNumberOfRows(); y++) {
       MyTableCash2_extended.setValue(y, x, MyTableCash2_extended.getValue(y, x) / MyTableCash2_extended.getValue(y, 1));
       MyTableCash2_extended.setFormattedValue(y, x, parseInt(Math.round(MyTableCash2_extended.getValue(y, x) * 100)) + "%");
      }
     }

     MyTableCash2_extended.removeColumn(1);
     // MyTableCash1.insertColumn(2);
     MyViewCash2 = new google.visualization.DataView(MyTableCash2_extended);
     break;
   }
    // var MyTableCash2 = new google.visualization.DataTable();
    // MyTableCash2 = MyViewCash2.toDataTable();

    //// Change labels of last three columns !!!--- not needed now
    // MyTableCash2.setColumnLabel(2, 'Net operating activities index')
    // MyTableCash2.setColumnLabel(3, 'Capex index')
 
    var optionsMyChartCash2 = {
      // title: SelectedEntity,
      titlePosition: "out",
      // width: 450,
      height: 260,
      pointSize: 3,
      backgroundColor: "#e4e8ed",
      series: {
        0: {
          type: "bars",
          color: "#006746",
          targetAxisIndex: 0
        },
        1: {
          type: "bars",
          color: "#c03200",
          // lineWidth: 3,
          // pointSize: 8,
          targetAxisIndex: 0
        },
        2: {
          type: "bars",
          color: "#161b21",
          // lineWidth: 3,
          // pointSize: 8,
          targetAxisIndex: 0
        },
        // 3: {
        //   type: "line",
        //   color: "#f8982d",
        //   lineWidth: 3,
        //   pointSize: 8,
        //   targetAxisIndex: 1
        // }
      },
      hAxis: {
        format: "####",
        textPosition: "out",
        textStyle: { color: "#595959", fontSize: 12 },
        // slantedText: true,
        // slantedTextAngle: 90,
        // gridlines: "{ count: MyViewIncome1.getNumberOfRows() }"
        gridlines: { count: 0 }
      },
      vAxes: {
        0: {
          format: MyFormatVaxis2,
          textStyle: { color: "#595959", fontSize: 12 },
          title: MyTitleVaxis2,
          titleTextStyle: { italic: false, bold: true, color: "#595959", fontSize: 12 }
        },
        // 1: {
        //   format: "#,###",
        //   textStyle: { color: "#595959", fontSize: 12 },
        //   title: "Cash Flow & Revenue Index (2017=100)", // !!!to be changed to 100 when datasheet is fixed
        //   titleTextStyle: { italic: false, bold: true, color: "#595959", fontSize: 12 },
        //   gridlines: { count: 0 }
        // }
      },
      legend: {
        position: "right",
        alignment: "center",
        textStyle: { color: "#595959", fontSize: 12 }
        // maxLines: 2, //Only works on top!!
      },
      animation: {
        duration: 200,
        easing: "inAndOut"
      },
      chartArea: {
        left: 60,
        bottom: 30,
        // right: 80,
        width: "65%",
        height: "70%"
      }
    };
    MyChartCash2.draw(MyViewCash2, optionsMyChartCash2);
  }

  //---------------------------MyTableNetCash update ---------------------------------------------
  function UpdateMyTableCash() {
    MyViewTableCash = new google.visualization.DataView(Data);
    MyViewTableCash.setRows(
      Data.getFilteredRows([{ column: 1, value: SelectedEntity }])
    );
    MyViewTableCash.setColumns([0, 25, 26, 33, 34]);

    // Transpose table
    TransposedTableCash = new google.visualization.DataTable();
    // Add first column from original datatable
    TransposedTableCash.addColumn('string', '');
    // Convert column labels to row labels
    for (var x = 1; x < MyViewTableCash.getNumberOfColumns(); x++) {
      var label = MyViewTableCash.getColumnLabel(x);
      TransposedTableCash.addRow([label]);
    }
    // Convert row labels and data to columns
    for (var x = 0; x < MyViewTableCash.getNumberOfRows(); x++) {
      TransposedTableCash.addColumn('number', MyViewTableCash.getValue(x, 0)); // Use first column date as label
      for (var y = 1; y < MyViewTableCash.getNumberOfColumns(); y++) {
        TransposedTableCash.setValue(y - 1, x + 1, MyViewTableCash.getValue(x, y));
      }
    }
    // add last column comparing selected year v selected year-1
    TransposedTableCash.addColumn('number', TransposedTableCash.getColumnLabel(SelectedYear - MinYear + 1) + '/' + TransposedTableCash.getColumnLabel(SelectedYear - MinYear));
    for (var z = 0; z < TransposedTableCash.getNumberOfRows(); z++) {
      // alert(TransposedTable.getValue(z, x));
      if (TransposedTableCash.getValue(z, SelectedYear - MinYear) == 0) {
        TransposedTableCash.setValue(z, x + 1, 0);
      }
      else { 
        // we use different formulas for certain columns  
        var YoYVariation = (z == 1 || z == 2) ? ((-TransposedTableCash.getValue(z, SelectedYear - MinYear + 1)) / (-TransposedTableCash.getValue(z, SelectedYear - MinYear))-1) : (TransposedTableCash.getValue(z, SelectedYear - MinYear + 1) - TransposedTableCash.getValue(z, SelectedYear - MinYear)) / Math.abs(TransposedTableCash.getValue(z, SelectedYear - MinYear))
        TransposedTableCash.setValue(z, x + 1, YoYVariation) 
      }
    }

    var cssClassNames = {
      'headerRow': 'MyTableHeader',
      'headerCell': 'MyHeaderCell',
      'tableCell': 'MyTableCell',
    };
    var options = { alternatingRowStyle: false, 'allowHtml': true, 'cssClassNames': cssClassNames, sort: 'disable', width: 580 };
    TransposedTableCash.setRowProperty(3, "className", "font-weight-bold");

    var formatter1 = new google.visualization.NumberFormat(
      { prefix: '', negativeColor: 'red', pattern: MyPattern });
    var formatter2 = new google.visualization.NumberFormat(
      { prefix: '', pattern: '+0.0%;-0.0%' });

    for (var i = 1; i < TransposedTableCash.getNumberOfColumns() - 1; i++) {
      formatter1.format(TransposedTableCash, i);
    }
    formatter2.format(TransposedTableCash, i)
    TransposedTableCash.setColumnProperty(i, "className", "font-italic");
    // tempTable.setColumnProperty(2, "className", "Mybluedata");
    // tempTable.setProperty(0, 2, "className", "MyTableHeader");
    MyTableCash.draw(TransposedTableCash, options);
  }

  //---------------------------MyTableFreeCash update ---------------------------------------------
  function UpdateMyTableFreeCash() {
    MyViewTableFreeCash = new google.visualization.DataView(Data);
    MyViewTableFreeCash.setRows(
      Data.getFilteredRows([{ column: 1, value: SelectedEntity }])
    );
    MyViewTableFreeCash.setColumns([0, 25, 41, 27]);

      // Transpose table
      TransposedTableFreeCash = new google.visualization.DataTable();
      // Add first column from original datatable
      TransposedTableFreeCash.addColumn('string', '');
      // Convert column labels to row labels
      for (var x = 1; x < MyViewTableFreeCash.getNumberOfColumns(); x++) {
        var label = MyViewTableFreeCash.getColumnLabel(x);
        TransposedTableFreeCash.addRow([label]);
      }
      // Convert row labels and data to columns
      for (var x = 0; x < MyViewTableFreeCash.getNumberOfRows(); x++) {
        TransposedTableFreeCash.addColumn('number', MyViewTableFreeCash.getValue(x, 0)); // Use first column date as label
        for (var y = 1; y < MyViewTableFreeCash.getNumberOfColumns(); y++) {
          TransposedTableFreeCash.setValue(y - 1, x + 1, MyViewTableFreeCash.getValue(x, y));
        }
      }
      // add last column comparing selected year v selected year-1
      TransposedTableFreeCash.addColumn('number', TransposedTableFreeCash.getColumnLabel(SelectedYear - MinYear + 1) + '/' + TransposedTableFreeCash.getColumnLabel(SelectedYear - MinYear));
      for (var z = 0; z < TransposedTableFreeCash.getNumberOfRows(); z++) {
        // alert(TransposedTable.getValue(z, x));
        if (TransposedTableFreeCash.getValue(z, SelectedYear - MinYear) == 0) {
          TransposedTableFreeCash.setValue(z, x + 1, 0);
        }
        else {
          // we use different formulas for certain columns  
          var YoYVariation = (z == 1) ? ((-TransposedTableFreeCash.getValue(z, SelectedYear - MinYear + 1)) / (-TransposedTableFreeCash.getValue(z, SelectedYear - MinYear)) - 1) : (TransposedTableFreeCash.getValue(z, SelectedYear - MinYear + 1) - TransposedTableFreeCash.getValue(z, SelectedYear - MinYear)) / Math.abs(TransposedTableFreeCash.getValue(z, SelectedYear - MinYear))
          TransposedTableFreeCash.setValue(z, x + 1, YoYVariation)
        }
      }

      var cssClassNames = {
        'headerRow': 'MyTableHeader',
        'headerCell': 'MyHeaderCell',
        'tableCell': 'MyTableCell',
      };
      var options = { alternatingRowStyle: false, 'allowHtml': true, 'cssClassNames': cssClassNames, sort: 'disable', width: 580 };
      TransposedTableFreeCash.setRowProperty(2, "className", "font-weight-bold");

      var formatter1 = new google.visualization.NumberFormat(
        { prefix: '', negativeColor: 'red', pattern: MyPattern });
      var formatter2 = new google.visualization.NumberFormat(
        { prefix: '', pattern: '+0.0%;-0.0%' });

      for (var i = 1; i < TransposedTableFreeCash.getNumberOfColumns() - 1; i++) {
        formatter1.format(TransposedTableFreeCash, i);
      }
      formatter2.format(TransposedTableFreeCash, i)
      TransposedTableFreeCash.setColumnProperty(i, "className", "font-italic");
      // tempTable.setColumnProperty(2, "className", "Mybluedata");
      // tempTable.setProperty(0, 2, "className", "MyTableHeader");
      MyTableFreeCash.draw(TransposedTableFreeCash, options);
  }

//---------------------------MyTitles update ---------------------------------------------
  function UpdateTitles() {

  // Fill in the ANSP extra services table 

    var ANSP_Full_Name = new google.visualization.DataView(Data);
    ANSP_Full_Name.setRows(
      Data.getFilteredRows([{ column: 0, value: SelectedYear }])
    );
    ANSP_Full_Name.setRows(
      Data.getFilteredRows([{ column: 1, value: SelectedEntity }])
    );
    ANSP_Full_Name.setColumns([58]);
  
    var CheckClass = [];
    for (var x = 0; x < MyViewANSPServices.getNumberOfColumns()-1; x++) {
      CheckClass.push(MyViewANSPServices.getValue(0, x) != null? "fa fa-check text-black" : "fa fa-check text-white");
     }
    
    OAT_Services.className = CheckClass[0];
    Oceanic_Services.className = CheckClass[1];
    // MUAC.className = CheckClass[2];
    Delegated_ATM.className = CheckClass[2];
    Internal_MET.className = CheckClass[3];
    Airports.className = CheckClass[4];

  // Update ANSP characteristics in the first section 

    document.getElementById("ANSP_Full_Name").innerHTML = ANSP_Full_Name.getValue(0, 0);
    document.getElementById("ANSP_logo").innerHTML = '<img src="ANSP_logos/' + SelectedEntity + '.png" style="height:40px; margin-bottom:5px">';
    document.getElementById("Ownership").innerHTML = MyViewANSPServices.getValue(0, 5);
    document.getElementById("MyTitleShareRevenue_div").innerHTML = "Revenue Share of Pan-European System (" + (MyTableShareTotalRevenue.getValue(0, 1) < 0.001 ? Math.round(MyTableShareTotalRevenue.getValue(0, 1) * 10000) / 100 : Math.round(MyTableShareTotalRevenue.getValue(0, 1) * 1000) / 10) + "%)";
    // document.getElementById("Ownership").innerHTML = MyViewANSPServices.getValue(0, 5);

  // Update all titles - section titles, scorecard titles, etc.

    document.getElementById("Title_EBITDAMargin").innerHTML = "EBITDA Margin " + SelectedYear + "";
    document.getElementById("Title_EBITMargin").innerHTML = "EBIT Margin " + SelectedYear + "";
    document.getElementById("Title_Revenue").innerHTML = "Revenue " + SelectedYear + "";
    document.getElementById("Title_OPEX").innerHTML = " " + SelectedYear;
    document.getElementById("Title_LiabilitiesEquity").innerHTML = 'Liabilites & Equity - ' + SelectedYear;
    document.getElementById("Title_DebtToEquity").innerHTML = "Equity ratio " + SelectedYear + "";
    document.getElementById("Title_CurrentRatio").innerHTML = "Current ratio " + SelectedYear + "";
    document.getElementById("Title_DaysOPEX").innerHTML = "Cash-on-hand days " + SelectedYear + "";
    document.getElementById("Title_NetCashFlow").innerHTML = "Net cash flow " + SelectedYear + "";
    document.getElementById("Title_NetInvestment").innerHTML = "Investing activities " + SelectedYear + "";
    document.getElementById("income_title").innerHTML = "Income Statement (" + SelectedEntity + ")";
    document.getElementById("balance_title").innerHTML = "Balance Sheet (" + SelectedEntity + ")";
    document.getElementById("cashflow_title").innerHTML = "Cash Flow Statement (" + SelectedEntity + ")";
    document.getElementById("Title_FreeCashFlow").innerHTML = "Free cash flow " + SelectedYear + "";
    document.getElementById("Title_Capex").innerHTML = " " + SelectedYear;

    document.getElementById("incomeitems_title").innerHTML = "Income Statement Items (" + NatCurrency + " " + CurrMultiplierString + ")";
    document.getElementById("balanceitems_title").innerHTML = "Balance Sheet Items (" + NatCurrency + " " + CurrMultiplierString + ")";
    document.getElementById("cashflowitems_title").innerHTML = "Net Cash Flow Items (" + NatCurrency + " " + CurrMultiplierString + ")";
    document.getElementById("freecashflowitems_title").innerHTML = "Free Cash Flow Items (" + NatCurrency + " " + CurrMultiplierString + ")";

   document.getElementById("equliab_subtitle").innerHTML = "Liabilities & Equity (" + NatCurrency + " " + CurrMultiplierString + ")";
   document.getElementById("liabilities_subtitle").innerHTML = "Total Liabilites (" + NatCurrency + " " + CurrMultiplierString + ")";
   document.getElementById("equity_subtitle").innerHTML = "Shareholders Equity (" + NatCurrency + " " + CurrMultiplierString + ")";

  // Calculate scorecard values
     
    var Scorecard_EBITDAMargin =  Math.round(MyViewIncome2.getValue(SelectedYear - MinYear, 1)*100);
    var Dif_EBITDAMargin = (SelectedYear == MinYear) ? "-" : Math.round((MyViewIncome2.getValue(SelectedYear - MinYear, 1)- MyViewIncome2.getValue(SelectedYear - MinYear-1, 1)) * 100);
     Dif_EBITDAMargin = (Dif_EBITDAMargin > 0) ? "+" + Dif_EBITDAMargin : "" + Dif_EBITDAMargin; // add + sign

    var Scorecard_EBITMargin = Math.round(MyViewIncome2.getValue(SelectedYear - MinYear, 3) * 100);
    var Dif_EBITMargin = (SelectedYear == MinYear) ? "-" : Math.round((MyViewIncome2.getValue(SelectedYear - MinYear, 3) - MyViewIncome2.getValue(SelectedYear - MinYear - 1, 3)) * 100);
    Dif_EBITMargin = (Dif_EBITMargin > 0) ? "+" + Dif_EBITMargin : "" + Dif_EBITMargin; // add + sign
    
    var Scorecard_Revenue = Math.round(MyViewTableIncome.getValue(SelectedYear - MinYear, 1)* DecimalsDivisor)/ DecimalsDivisor;

    var Dif_Revenue = (SelectedYear == MinYear) ? "-" : Math.round(((MyViewTableIncome.getValue(SelectedYear - MinYear, 1)- MyViewTableIncome.getValue(SelectedYear - MinYear - 1, 1))/Math.abs(MyViewTableIncome.getValue(SelectedYear - MinYear - 1, 1)))*1000)/10 ;
     Dif_Revenue = (Dif_Revenue > 0) ? "+" + Dif_Revenue : "" + Dif_Revenue; // add + sign

    var Scorecard_OPEX = Math.abs(Math.round(MyViewTableIncome.getValue(SelectedYear - MinYear, 2)* DecimalsDivisor)/ DecimalsDivisor);

    var Dif_OPEX = (SelectedYear == MinYear) ? "-" : Math.round(((-MyViewTableIncome.getValue(SelectedYear - MinYear, 2) + MyViewTableIncome.getValue(SelectedYear - MinYear - 1, 2))/Math.abs(MyViewTableIncome.getValue(SelectedYear - MinYear - 1, 2))) * 1000) / 10;
    Dif_OPEX = (Dif_OPEX > 0) ? "+" + Dif_OPEX : "" + Dif_OPEX; // add + sign

    var Scorecard_Liab = Math.round(TransposedTableBalance.getValue(TransposedTableBalance.getNumberOfRows() - 3, SelectedYear - MinYear + 1) + TransposedTableBalance.getValue(TransposedTableBalance.getNumberOfRows() - 2, SelectedYear - MinYear + 1)* DecimalsDivisor)/ DecimalsDivisor;
    
    var Scorecard_Equity = Math.round(TransposedTableBalance.getValue(TransposedTableBalance.getNumberOfRows() - 4, SelectedYear - MinYear + 1)* DecimalsDivisor)/ DecimalsDivisor;

    var Scorecard_LiabEqui = Math.round(TransposedTableBalance.getValue(TransposedTableBalance.getNumberOfRows() - 1, SelectedYear - MinYear + 1)* DecimalsDivisor)/ DecimalsDivisor;

    var Scorecard_DebtToEquity = Math.round(Scorecard_Equity / Scorecard_LiabEqui * 100) / 100;
    var Dif_DebtToEquity = (SelectedYear == MinYear) ? "-" : Math.round((TransposedTableBalance.getValue(TransposedTableBalance.getNumberOfRows() - 4, SelectedYear - MinYear))/ TransposedTableBalance.getValue(TransposedTableBalance.getNumberOfRows() - 1, SelectedYear - MinYear) * 100) / 100;

    var Scorecard_DaysOPEX = Math.round(MyViewBalance2.getValue(SelectedYear - MinYear, 2));
    var Dif_DaysOPEX = (SelectedYear == MinYear) ? "-" : Math.round(MyViewBalance2.getValue(SelectedYear - MinYear -1, 2))

    var Scorecard_CurrentRatio = Math.round(MyViewBalance3.getValue(SelectedYear - MinYear, 3) * 10) / 10;
    var Dif_CurrentRatio = (SelectedYear == MinYear) ? "-" : Math.round(MyViewBalance3.getValue(SelectedYear - MinYear - 1, 3) * 10) / 10

    var Scorecard_NetCashFlow =  Math.round(MyViewCash1.getValue(SelectedYear - MinYear, 4)*DecimalsDivisor)/ DecimalsDivisor;
    
    var Dif_NetCashFlow = (SelectedYear == MinYear) ? "-" : Math.round(((MyViewCash1.getValue(SelectedYear - MinYear, 4) - MyViewCash1.getValue(SelectedYear - MinYear - 1, 4))/Math.abs(MyViewCash1.getValue(SelectedYear - MinYear - 1, 4))) * 1000) / 10;
    Dif_NetCashFlow = (Dif_NetCashFlow > 0) ? "+" + Dif_NetCashFlow : "" + Dif_NetCashFlow; // add + sign

    var Scorecard_NetInvestment = -Math.round(MyViewCash1.getValue(SelectedYear - MinYear, 2)* DecimalsDivisor)/ DecimalsDivisor;
    
    var Dif_NetInvestment = (SelectedYear == MinYear) ? "-" : Math.round(((-MyViewCash1.getValue(SelectedYear - MinYear, 2) + MyViewCash1.getValue(SelectedYear - MinYear - 1, 2))/Math.abs(MyViewCash1.getValue(SelectedYear - MinYear - 1, 2))) * 1000) / 10;
    Dif_NetInvestment = (Dif_NetInvestment > 0) ? "+" + Dif_NetInvestment : "" + Dif_NetInvestment; // add + sign

    var Scorecard_FreeCashFlow = Math.round(MyViewTableFreeCash.getValue(SelectedYear - MinYear, 3)* DecimalsDivisor)/ DecimalsDivisor;

    var Dif_FreeCashFlow = (SelectedYear == MinYear) ? "-" : Math.round(((MyViewTableFreeCash.getValue(SelectedYear - MinYear, 3) - MyViewTableFreeCash.getValue(SelectedYear - MinYear - 1, 3)) / Math.abs(MyViewTableFreeCash.getValue(SelectedYear - MinYear - 1, 3))) * 1000) / 10;
    Dif_FreeCashFlow = (Dif_FreeCashFlow > 0) ? "+" + Dif_FreeCashFlow : "" + Dif_FreeCashFlow; // add + sign

    var Scorecard_Capex = -Math.round(MyViewTableFreeCash.getValue(SelectedYear - MinYear, 2)* DecimalsDivisor)/ DecimalsDivisor;

    var Dif_Capex = (SelectedYear == MinYear) ? "-" : Math.round(((-MyViewTableFreeCash.getValue(SelectedYear - MinYear, 2) + MyViewTableFreeCash.getValue(SelectedYear - MinYear - 1, 2)) / Math.abs(MyViewTableFreeCash.getValue(SelectedYear - MinYear - 1, 2))) * 1000) / 10;
    Dif_Capex = (Dif_Capex > 0) ? "+" + Dif_Capex : "" + Dif_Capex; // add + sign


  // Update scorecard values
    // ---- found this string function below in stack overflow to add thousandseparators
    document.getElementById("Scorecard_EBITDAMargin").innerHTML = String(Scorecard_EBITDAMargin)+"%";
    document.getElementById("Dif_EBITDAMargin").innerHTML = (SelectedYear == MinYear) ? "" : Dif_EBITDAMargin + " p.p. vs. " + (SelectedYear - 1);
    document.getElementById("Scorecard_EBITMargin").innerHTML = String(Scorecard_EBITMargin) + "%";
    document.getElementById("Dif_EBITMargin").innerHTML = (SelectedYear == MinYear) ? "" : Dif_EBITMargin + " p.p. vs. " + (SelectedYear - 1);
    document.getElementById("Scorecard_Revenue").innerHTML = String(Scorecard_Revenue).replace(/(.)(?=(\d{3})+$)/g, '$1,');
    document.getElementById("Scorecard_Revenue_Curr").innerHTML =  NatCurrency + " " + CurrMultiplierString; 

    document.getElementById("Dif_Revenue").innerHTML = (SelectedYear == MinYear) ? "" : Dif_Revenue + "% vs. " + (SelectedYear-1);
    
    document.getElementById("Scorecard_OPEX").innerHTML = String(Scorecard_OPEX).replace(/(.)(?=(\d{3})+$)/g, '$1,'); 
    document.getElementById("Scorecard_OPEX_Curr").innerHTML = NatCurrency + " " + CurrMultiplierString; 

    document.getElementById("Dif_OPEX").innerHTML = (SelectedYear == MinYear) ? "" : Dif_OPEX + "% vs. " + (SelectedYear - 1);
    document.getElementById("Scorecard_DebtToEquity").innerHTML = String(Scorecard_DebtToEquity).replace(/(.)(?=(\d{3})+$)/g, '$1,');
    document.getElementById("Dif_DebtToEquity").innerHTML = (SelectedYear == MinYear) ? "" : String(Dif_DebtToEquity) + " in " + (SelectedYear-1);
    document.getElementById("Scorecard_CurrentRatio").innerHTML = String(Scorecard_CurrentRatio);
    document.getElementById("Dif_CurrentRatio").innerHTML = (SelectedYear == MinYear) ? "" : String(Dif_CurrentRatio) + " in " + (SelectedYear - 1);
    document.getElementById("Scorecard_DaysOPEX").innerHTML = String(Scorecard_DaysOPEX);
    document.getElementById("Dif_DaysOPEX").innerHTML = (SelectedYear == MinYear) ? "" : String(Dif_DaysOPEX) + " in " + (SelectedYear - 1);
    
    document.getElementById("Scorecard_NetCashFlow").innerHTML = (Scorecard_NetCashFlow<0) ? '-' + String(Math.abs(Scorecard_NetCashFlow)).replace(/(.)(?=(\d{3})+$)/g, '$1,') : String(Scorecard_NetCashFlow).replace(/(.)(?=(\d{3})+$)/g, '$1,');
    document.getElementById("Scorecard_NetCashFlow_Curr").innerHTML = NatCurrency + " " + CurrMultiplierString;

    document.getElementById("Dif_NetCashFlow").innerHTML = (SelectedYear == MinYear) ? "" : Dif_NetCashFlow + "% vs. " + (SelectedYear - 1);

    document.getElementById("Scorecard_NetInvestment").innerHTML = (Scorecard_NetInvestment<0) ? '-' + String(Math.abs(Scorecard_NetInvestment)).replace(/(.)(?=(\d{3})+$)/g, '$1,') : String(Scorecard_NetInvestment).replace(/(.)(?=(\d{3})+$)/g, '$1,');
    document.getElementById("Scorecard_NetInvestment_Curr").innerHTML = NatCurrency + " " + CurrMultiplierString;

    document.getElementById("Dif_NetInvestment").innerHTML = (SelectedYear == MinYear) ? "" : Dif_NetInvestment + "% vs. " + (SelectedYear - 1);

    document.getElementById("Scorecard_FreeCashFlow").innerHTML = (Scorecard_FreeCashFlow < 0) ? '-' + String(Math.abs(Scorecard_FreeCashFlow)).replace(/(.)(?=(\d{3})+$)/g, '$1,') : String(Scorecard_FreeCashFlow).replace(/(.)(?=(\d{3})+$)/g, '$1,');
    document.getElementById("Scorecard_FreeCashFlow_Curr").innerHTML = NatCurrency + " " + CurrMultiplierString;

    document.getElementById("Dif_FreeCashFlow").innerHTML = (SelectedYear == MinYear) ? "" : Dif_FreeCashFlow + "% vs. " + (SelectedYear - 1);

    document.getElementById("Scorecard_Capex").innerHTML = (Scorecard_Capex < 0) ? '-' + String(Math.abs(Scorecard_Capex)).replace(/(.)(?=(\d{3})+$)/g, '$1,') : String(Scorecard_Capex).replace(/(.)(?=(\d{3})+$)/g, '$1,');
    document.getElementById("Scorecard_Capex_Curr").innerHTML = NatCurrency + " " + CurrMultiplierString;

    document.getElementById("Dif_Capex").innerHTML = (SelectedYear == MinYear) ? "" : Dif_Capex + "% vs. " + (SelectedYear - 1);

    document.getElementById("Scorecard_Liab").innerHTML = String(Scorecard_Liab).replace(/(.)(?=(\d{3})+$)/g, '$1,'); 
    document.getElementById("Scorecard_Equity").innerHTML = String(Scorecard_Equity).replace(/(.)(?=(\d{3})+$)/g, '$1,'); 
    document.getElementById("Scorecard_LiabEqui").innerHTML = String(Scorecard_LiabEqui).replace(/(.)(?=(\d{3})+$)/g, '$1,');

  }

  //--------------------------------------------------------------------
  // function SelectEntityInIncome3Chart() { 
  //   for (j = 0; j < MyViewIncome3.getNumberOfRows(); j++) {
  //     if (MyViewIncome3.getValue(j, 0) == SelectedEntity) {
  //       MySelectedRow = j
  //     }
  //   };

  //   MyChartIncome3.setSelection([{ row: MySelectedRow }]);
  // }
    //--------------------------------------------------------------------
  // function SelectEntityInBalance4Chart() {
  //   for (j = 0; j < MyViewBalance4.getNumberOfRows(); j++) {
  //     if (MyViewBalance4.getValue(j, 0) == SelectedEntity) {
  //       MySelectedRow = j
  //     }
  //     };

  //   MyChartBalance4.setSelection([{ row: MySelectedRow }]);
  // }
    //--------------------------------------------------------------------
  // function SelectEntityInCash3Chart() {
  //   for (j = 0; j < MyViewCash3.getNumberOfRows(); j++) {
  //     if (MyViewCash3.getValue(j, 0) == SelectedEntity) {
  //       MySelectedRow = j
  //     }
  //   };

  //   MyChartCash3.setSelection([{ row: MySelectedRow }]);
  // }
</script>
