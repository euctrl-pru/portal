---
title: Dashboard - Airport
layout: default
---

```{r setup, message=FALSE, warning=FALSE, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  error = FALSE,
  NULL
)

library(leaflet)
library(leaflet.extras)
library(readr)
library(here)
library(dplyr)
library(stringr)
library(htmltools)
library(gt)
```

Please **select**/**search** the airport you are interested in from the following map:
<div id="airportfindbox"></div>
<br>

```{r airport-selection-map, out.width='80%'}
# a lot to learn from https://www.jla-data.net/eng/leaflet-in-r-tips-and-tricks/
pop <- str_c(
  "<a href='{icao}.html'>{name}</a> ({country})<br>",
  "<span style='font-variant: small-caps;'>ICAO</span>: <b>{icao}</b>/",
  "<span style='font-variant: small-caps;'>IATA</span>: <b>{iata}</b>")
tit <- "{name}, {country} ({icao}/{iata})"
apt <- readr::read_csv2(here("data-config", "APT_DSHBD_AIRPORT.csv")) %>%
  dplyr::select(
    icao    = ICAO_CODE,
    iata    = IATA_CODE,
    country = CTRY_ABBREVIATION,
    name    = APDF_NAME,
    lon     = LON,
    lat     = LAT)

apt %>%
leaflet() %>%
  addTiles() %>%
  addMarkers(~lon, ~lat,
             group = "airports",
             popup = ~str_glue(pop) %>%
               lapply(htmltools::HTML),
             label = ~str_glue(tit) %>%
               lapply(htmltools::HTML)
             ) %>%
  addSearchFeatures(targetGroups = "airports",
                    options = searchFeaturesOptions(
                      # position = 'topleft',
                      zoom = 8.25,
                      collapsed = FALSE,
                      container = 'airportfindbox'
                    ))
  
```

<br>

```{r airport-selection-table,out.width='80%'}
library(gt)

apt %>%
  select(-c("lon", "lat")) %>%
  mutate(
    name = glue::glue("[{name}]({icao}.html)"),
    name = purrr::map(name, gt::md),
  ) %>%
  relocate(name, icao, iata) %>%
  group_by(country) %>%
  gt(
    rowname_col = "name",
    groupname_col = "country"
  ) %>%
  tab_header(title = "Airports in the dashboard") %>%
  cols_align(
    align = "left",
    columns = c(name)
  )
```

